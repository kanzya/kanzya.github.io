<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="ASIS CTF 2022 writeup" /><meta name="author" content="kanon" /><meta property="og:locale" content="en" /><meta name="description" content="初めに" /><meta property="og:description" content="初めに" /><link rel="canonical" href="https://kanzya.github.io/posts/ASIS-CTF-writeup/" /><meta property="og:url" content="https://kanzya.github.io/posts/ASIS-CTF-writeup/" /><meta property="og:site_name" content="kanon" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-10-15T15:59:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="ASIS CTF 2022 writeup" /><meta name="twitter:site" content="@_k4non" /><meta name="twitter:creator" content="@kanon" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"kanon"},"dateModified":"2024-03-22T19:18:25+09:00","datePublished":"2022-10-15T15:59:00+09:00","description":"初めに","headline":"ASIS CTF 2022 writeup","mainEntityOfPage":{"@type":"WebPage","@id":"https://kanzya.github.io/posts/ASIS-CTF-writeup/"},"url":"https://kanzya.github.io/posts/ASIS-CTF-writeup/"}</script><title>ASIS CTF 2022 writeup | kanon</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="kanon"><meta name="application-name" content="kanon"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&family=Noto+Sans+JP:wght@400;600;700;900"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://raw.githubusercontent.com/kanzya/photo/main/image.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">kanon</a></div><div class="site-subtitle font-italic">just a person</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/kanzya" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/_k4non" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['pahc1h8a','s.okayama-u.ac.jp'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>ASIS CTF 2022 writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4 pb-5"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>ASIS CTF 2022 writeup</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1665817140" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 15, 2022 </em> </span> <span> Updated <em class="" data-ts="1711102705" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Mar 22, 2024 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4143 words"> <em>23 min</em> read</span></div></div></div><div class="post-content"><h1 id="初めに">初めに</h1><p>ASISです。祭りと被って死ぬかと思いましたまる。。</p><h2 id="crypto-binned148-solve"><span class="mr-2">[crypto] Binned　[148 solve]</span><a href="#crypto-binned148-solve" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="chall"><span class="mr-2">chall</span><a href="#chall" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div file="binned.py" class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="binned.py"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">gensafeprime</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">flag</span> <span class="kn">import</span> <span class="n">flag</span>

<span class="k">def</span> <span class="nf">keygen</span><span class="p">(</span><span class="n">nbit</span><span class="p">):</span>
	<span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="n">generate</span><span class="p">(</span><span class="n">nbit</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">pubkey</span><span class="p">):</span>
	<span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">pubkey</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">pubkey</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">keygen</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>

<span class="n">flag</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<span class="n">enc</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'pubkey = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'enc = </span><span class="si">{</span><span class="n">enc</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
</pre></table></code></div></div><h3 id="solve"><span class="mr-2">solve</span><a href="#solve" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>encryptで$enc = (pubkey+1)^m \pmod {pubkey^3}$ で暗号されているので式変形を施す。 \(enc =(pub+1)^m \pmod {pub^3} \\ = \sum_{i=0}^m \ _m C_i(pub^i+1^{m-i}) \pmod {pub^3}\\ = 1 +m*pub + \frac{m*(m-1)}{2}pub^2\\\) となるので、方程式を解いてやれば$m$が求まる。</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">pubkey</span> <span class="o">=</span> <span class="mi">125004899806380680278294077957993138206121343727674199724251084023100054797391533591150992663742497532376954423241741439218367086541339504325939051995057848301514908377941815605487168789148131591458301036686411659334843972203243490288676763861925647147178902977362125434420265824374952540259396010995154324589</span>
<span class="n">enc</span> <span class="o">=</span> <span class="mi">789849126571263315208956108629196540107771075292285804732934458641661099043398300667318883764744131397353851782194467024270666326116745519739176492710750437625345677766980300328542459318943175684941281413218985938348407537978884988013947538034827562329111515306723274989323212194585378159386585826998838542734955059450048745917640814983343040930383529332576453845724747105810109832978045135562492851617884175410194781236450629682032219153517122695586503298477875749138129517477339813480115293124316913331705913455692462482942654717828006590051944205639923326375814299624264826939725890226430388059890231323791398412019416647826367964048142887158552454494856771139750458462334678907791079639005383932256589768726730285409763583606927779418528562990619985840033479201147509241313757191997545174262930707521451438204766627975109619779824255444258160</span>

<span class="n">PR</span><span class="p">.</span><span class="o">&lt;</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">QQ</span><span class="p">[]</span>
<span class="n">polys</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="n">n</span>  <span class="o">+</span> <span class="p">(</span><span class="n">m</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="n">m</span> <span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span><span class="p">(</span><span class="n">enc</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">pubkey</span> <span class="o">-</span> <span class="n">n</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">Ideal</span><span class="p">(</span><span class="n">polys</span><span class="p">)</span>
<span class="n">ans</span> <span class="o">=</span> <span class="n">I</span><span class="p">.</span><span class="n">variety</span><span class="p">(</span><span class="n">ring</span><span class="o">=</span><span class="n">ZZ</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
<span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">ans</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="n">ans</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

<span class="k">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
</pre></table></code></div></div><h2 file="solve.py" id="crypto-chaffymasking61-solve">[crypto] Chaffymasking　[61 solve]</h2><h3 id="chall-1"><span class="mr-2">chall</span><a href="#chall-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="solve.py"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">binascii</span>
<span class="kn">import</span> <span class="nn">os</span><span class="p">,</span> <span class="n">sys</span>
<span class="kn">from</span> <span class="nn">flag</span> <span class="kn">import</span> <span class="n">FLAG</span>

<span class="k">def</span> <span class="nf">die</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
	<span class="n">pr</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
	<span class="n">quit</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">pr</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
	<span class="n">s</span> <span class="o">=</span> <span class="s">" "</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">args</span><span class="p">))</span>
	<span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
	<span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">flush</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">sc</span><span class="p">():</span> 
	<span class="k">return</span> <span class="n">sys</span><span class="p">.</span><span class="n">stdin</span><span class="p">.</span><span class="nb">buffer</span><span class="p">.</span><span class="n">readline</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">pad</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
	<span class="n">result</span> <span class="o">=</span> <span class="n">inp</span> <span class="o">+</span> <span class="n">os</span><span class="p">.</span><span class="n">urandom</span><span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">))</span>
	<span class="k">return</span> <span class="n">result</span>

<span class="k">def</span> <span class="nf">byte_xor</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
	<span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">_a</span> <span class="o">^</span> <span class="n">_b</span> <span class="k">for</span> <span class="n">_a</span><span class="p">,</span><span class="n">_b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">))</span> 

<span class="k">def</span> <span class="nf">chaffy_mask</span><span class="p">(</span><span class="n">salt</span><span class="p">,</span> <span class="n">LTC</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
	<span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span>
	<span class="n">half1_salt</span> <span class="o">=</span> <span class="n">salt</span><span class="p">[:</span><span class="n">m</span> <span class="o">//</span> <span class="mi">8</span><span class="p">]</span>
	<span class="n">half2_salt</span> <span class="o">=</span> <span class="n">salt</span><span class="p">[</span><span class="n">m</span> <span class="o">//</span> <span class="mi">8</span><span class="p">:]</span>
	<span class="n">xor_salts</span> <span class="o">=</span> <span class="nb">int</span><span class="p">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">byte_xor</span><span class="p">(</span><span class="n">half1_salt</span><span class="p">,</span> <span class="n">half2_salt</span><span class="p">),</span> <span class="s">"big"</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">xor_salts</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">half1_salt</span> <span class="o">=</span> <span class="n">byte_xor</span><span class="p">(</span><span class="n">half1_salt</span><span class="p">,</span> <span class="n">os</span><span class="p">.</span><span class="n">urandom</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
	<span class="n">half1_binStr</span> <span class="o">=</span> <span class="s">"{:08b}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">half1_salt</span><span class="p">.</span><span class="nb">hex</span><span class="p">(),</span><span class="mi">16</span><span class="p">))</span>
	<span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">half1_binStr</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">):</span>
		<span class="n">half1_binStr</span> <span class="o">=</span> <span class="s">"0"</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">half1_binStr</span><span class="p">)</span><span class="o">%</span><span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">half1_binStr</span>
	<span class="n">half2_binStr</span> <span class="o">=</span> <span class="s">"{:08b}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">half2_salt</span><span class="p">.</span><span class="nb">hex</span><span class="p">(),</span><span class="mi">16</span><span class="p">))</span>
	<span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">half2_binStr</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">):</span>
		<span class="n">half2_binStr</span> <span class="o">=</span> <span class="s">"0"</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">half2_binStr</span><span class="p">)</span><span class="o">%</span><span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">half2_binStr</span>
	
	<span class="n">vec_1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">half1_binStr</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
	<span class="n">vec_1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">vec_1</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
	<span class="n">vec_2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">half2_binStr</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
	<span class="n">vec_2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">vec_2</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
	
	<span class="n">out_1</span> <span class="o">=</span> <span class="n">LTC</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vec_1</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span>
	<span class="n">out_2</span> <span class="o">=</span> <span class="n">LTC</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vec_2</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span>
	
	<span class="n">flag_vector</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="nb">ord</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">FLAG</span><span class="p">])</span>
	<span class="n">flag_vector</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">flag_vector</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
	<span class="n">masked_flag</span> <span class="o">=</span> <span class="p">(</span><span class="n">flag_vector</span> <span class="o">^</span> <span class="n">out_1</span> <span class="o">^</span> <span class="n">out_2</span><span class="p">)</span> <span class="o">%</span> <span class="mi">256</span>
	<span class="n">masked_flag</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">masked_flag</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,))</span>
	<span class="n">masked_flag</span> <span class="o">=</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">([</span><span class="nb">hex</span><span class="p">(</span><span class="n">_</span><span class="p">)[</span><span class="mi">2</span><span class="p">:].</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">masked_flag</span><span class="p">])</span>
	<span class="k">return</span> <span class="n">masked_flag</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
	<span class="n">border</span> <span class="o">=</span> <span class="s">"|"</span>
	<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="o">*</span><span class="mi">72</span><span class="p">)</span>
	<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="s">" Welcome to chaffymask combat, we implemented a masking method to   "</span><span class="p">,</span> <span class="n">border</span><span class="p">)</span>
	<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="s">" hide our secret. Masking is done by your 1024 bit input salt. Also "</span><span class="p">,</span> <span class="n">border</span><span class="p">)</span>
	<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="s">" I noticed that there is a flaw in my method. Can you abuse it and  "</span><span class="p">,</span> <span class="n">border</span><span class="p">)</span>
	<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="s">" get the flag? In each step you should send salt and get the mask.  "</span><span class="p">,</span> <span class="n">border</span><span class="p">)</span>
	<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="o">*</span><span class="mi">72</span><span class="p">)</span>

	<span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">64</span> 
	<span class="n">IVK</span> <span class="o">=</span> <span class="p">[</span>
	<span class="mi">3826</span><span class="p">,</span> <span class="mi">476</span><span class="p">,</span> <span class="mi">3667</span><span class="p">,</span> <span class="mi">2233</span><span class="p">,</span> <span class="mi">1239</span><span class="p">,</span> <span class="mi">1166</span><span class="p">,</span> <span class="mi">2119</span><span class="p">,</span> <span class="mi">2559</span><span class="p">,</span> <span class="mi">2376</span><span class="p">,</span> <span class="mi">1208</span><span class="p">,</span> <span class="mi">2165</span><span class="p">,</span> <span class="mi">2897</span><span class="p">,</span> <span class="mi">830</span><span class="p">,</span> <span class="mi">529</span><span class="p">,</span> <span class="mi">346</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">2188</span><span class="p">,</span> <span class="mi">4025</span><span class="p">,</span> 
	<span class="mi">3667</span><span class="p">,</span> <span class="mi">1829</span><span class="p">,</span> <span class="mi">3987</span><span class="p">,</span> <span class="mi">952</span><span class="p">,</span> <span class="mi">3860</span><span class="p">,</span> <span class="mi">2574</span><span class="p">,</span> <span class="mi">959</span><span class="p">,</span> <span class="mi">1394</span><span class="p">,</span> <span class="mi">1481</span><span class="p">,</span> <span class="mi">2822</span><span class="p">,</span> <span class="mi">3794</span><span class="p">,</span> <span class="mi">2950</span><span class="p">,</span> <span class="mi">1190</span><span class="p">,</span> <span class="mi">777</span><span class="p">,</span> <span class="mi">604</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">710</span><span class="p">,</span> <span class="mi">1765</span><span class="p">,</span> 
	<span class="mi">3752</span><span class="p">,</span> <span class="mi">2970</span><span class="p">,</span> <span class="mi">952</span><span class="p">,</span> <span class="mi">803</span><span class="p">,</span> <span class="mi">873</span><span class="p">,</span> <span class="mi">2647</span><span class="p">,</span> <span class="mi">2643</span><span class="p">,</span> <span class="mi">1096</span><span class="p">,</span> <span class="mi">1202</span><span class="p">,</span> <span class="mi">2236</span><span class="p">,</span> <span class="mi">1492</span><span class="p">,</span> <span class="mi">3372</span><span class="p">,</span> <span class="mi">2106</span><span class="p">,</span> <span class="mi">1868</span><span class="p">,</span> <span class="mi">535</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">3143</span><span class="p">,</span> <span class="mi">3370</span><span class="p">,</span> 
	<span class="mi">1</span><span class="p">,</span> <span class="mi">1643</span><span class="p">,</span> <span class="mi">2147</span><span class="p">,</span> <span class="mi">2368</span><span class="p">,</span> <span class="mi">3961</span><span class="p">,</span> <span class="mi">1339</span><span class="p">,</span> <span class="mi">552</span><span class="p">,</span> <span class="mi">2641</span><span class="p">,</span> <span class="mi">3222</span><span class="p">,</span> <span class="mi">2505</span><span class="p">,</span> <span class="mi">3449</span><span class="p">,</span> <span class="mi">1540</span><span class="p">,</span> <span class="mi">2024</span><span class="p">,</span> <span class="mi">618</span><span class="p">,</span> <span class="mi">1904</span><span class="p">,</span> <span class="mi">314</span><span class="p">,</span> <span class="mi">1306</span><span class="p">,</span> <span class="mi">3173</span><span class="p">,</span> 
	<span class="mi">4040</span><span class="p">,</span> <span class="mi">1488</span><span class="p">,</span> <span class="mi">1339</span><span class="p">,</span> <span class="mi">2545</span><span class="p">,</span> <span class="mi">2167</span><span class="p">,</span> <span class="mi">394</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">3169</span><span class="p">,</span> <span class="mi">897</span><span class="p">,</span> <span class="mi">4085</span><span class="p">,</span> <span class="mi">4067</span><span class="p">,</span> <span class="mi">3461</span><span class="p">,</span> <span class="mi">3444</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">3185</span><span class="p">,</span> <span class="mi">2267</span><span class="p">,</span> <span class="mi">3239</span><span class="p">,</span> <span class="mi">3612</span><span class="p">,</span> 
	<span class="mi">2775</span><span class="p">,</span> <span class="mi">580</span><span class="p">,</span> <span class="mi">3579</span><span class="p">,</span> <span class="mi">3623</span><span class="p">,</span> <span class="mi">1721</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">650</span><span class="p">,</span> <span class="mi">2755</span><span class="p">,</span> <span class="mi">1434</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">3167</span><span class="p">,</span> <span class="mi">323</span><span class="p">,</span> <span class="mi">589</span><span class="p">,</span> <span class="mi">3410</span><span class="p">,</span> <span class="mi">652</span><span class="p">,</span> <span class="mi">2746</span><span class="p">,</span> <span class="mi">2787</span><span class="p">,</span> <span class="mi">3665</span><span class="p">,</span> <span class="mi">828</span><span class="p">,</span> 
	<span class="mi">3200</span><span class="p">,</span> <span class="mi">1450</span><span class="p">,</span> <span class="mi">3147</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">3741</span><span class="p">,</span> <span class="mi">1055</span><span class="p">,</span> <span class="mi">505</span><span class="p">,</span> <span class="mi">2929</span><span class="p">,</span> <span class="mi">1423</span><span class="p">,</span> <span class="mi">3629</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1269</span><span class="p">,</span> <span class="mi">4066</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">2432</span><span class="p">,</span> <span class="mi">3306</span><span class="p">,</span> <span class="mi">4015</span><span class="p">,</span> <span class="mi">2350</span><span class="p">,</span> 
	<span class="mi">2154</span><span class="p">,</span> <span class="mi">2623</span><span class="p">,</span> <span class="mi">1304</span><span class="p">,</span> <span class="mi">493</span><span class="p">,</span> <span class="mi">763</span><span class="p">,</span> <span class="mi">1765</span><span class="p">,</span> <span class="mi">2608</span><span class="p">,</span> <span class="mi">695</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">2462</span><span class="p">,</span> <span class="mi">294</span><span class="p">,</span> <span class="mi">3656</span><span class="p">,</span> <span class="mi">3231</span><span class="p">,</span> <span class="mi">3647</span><span class="p">,</span> <span class="mi">3776</span><span class="p">,</span> <span class="mi">3457</span><span class="p">,</span> <span class="mi">2285</span><span class="p">,</span> <span class="mi">2992</span><span class="p">,</span> 
	<span class="mi">3997</span><span class="p">,</span> <span class="mi">603</span><span class="p">,</span> <span class="mi">2342</span><span class="p">,</span> <span class="mi">2283</span><span class="p">,</span> <span class="mi">3029</span><span class="p">,</span> <span class="mi">3299</span><span class="p">,</span> <span class="mi">1690</span><span class="p">,</span> <span class="mi">3281</span><span class="p">,</span> <span class="mi">3568</span><span class="p">,</span> <span class="mi">1927</span><span class="p">,</span> <span class="mi">2909</span><span class="p">,</span> <span class="mi">1797</span><span class="p">,</span> <span class="mi">1675</span><span class="p">,</span> <span class="mi">3245</span><span class="p">,</span> <span class="mi">2604</span><span class="p">,</span> <span class="mi">1272</span><span class="p">,</span> <span class="mi">1146</span><span class="p">,</span> 
	<span class="mi">3301</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">3712</span><span class="p">,</span> <span class="mi">2691</span><span class="p">,</span> <span class="mi">1097</span><span class="p">,</span> <span class="mi">1396</span><span class="p">,</span> <span class="mi">3694</span><span class="p">,</span> <span class="mi">3866</span><span class="p">,</span> <span class="mi">2066</span><span class="p">,</span> <span class="mi">1946</span><span class="p">,</span> <span class="mi">3476</span><span class="p">,</span> <span class="mi">1182</span><span class="p">,</span> <span class="mi">3409</span><span class="p">,</span> <span class="mi">3510</span><span class="p">,</span> <span class="mi">2920</span><span class="p">,</span> <span class="mi">2743</span><span class="p">,</span> <span class="mi">1126</span><span class="p">,</span> <span class="mi">2154</span><span class="p">,</span> 
	<span class="mi">3447</span><span class="p">,</span> <span class="mi">1442</span><span class="p">,</span> <span class="mi">2021</span><span class="p">,</span> <span class="mi">1748</span><span class="p">,</span> <span class="mi">1075</span><span class="p">,</span> <span class="mi">1439</span><span class="p">,</span> <span class="mi">3932</span><span class="p">,</span> <span class="mi">3438</span><span class="p">,</span> <span class="mi">781</span><span class="p">,</span> <span class="mi">1478</span><span class="p">,</span> <span class="mi">1708</span><span class="p">,</span> <span class="mi">461</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">1881</span><span class="p">,</span> <span class="mi">1353</span><span class="p">,</span> <span class="mi">2959</span><span class="p">,</span> <span class="mi">1225</span><span class="p">,</span> <span class="mi">1923</span><span class="p">,</span> 
	<span class="mi">1414</span><span class="p">,</span> <span class="mi">4046</span><span class="p">,</span> <span class="mi">3416</span><span class="p">,</span> <span class="mi">2845</span><span class="p">,</span> <span class="mi">1498</span><span class="p">,</span> <span class="mi">4036</span><span class="p">,</span> <span class="mi">3899</span><span class="p">,</span> <span class="mi">3878</span><span class="p">,</span> <span class="mi">766</span><span class="p">,</span> <span class="mi">3975</span><span class="p">,</span> <span class="mi">1355</span><span class="p">,</span> <span class="mi">2602</span><span class="p">,</span> <span class="mi">3588</span><span class="p">,</span> <span class="mi">3508</span><span class="p">,</span> <span class="mi">3660</span><span class="p">,</span> <span class="mi">3237</span><span class="p">,</span> <span class="mi">3018</span><span class="p">,</span> 
	<span class="mi">1619</span><span class="p">,</span> <span class="mi">2797</span><span class="p">,</span> <span class="mi">1823</span><span class="p">,</span> <span class="mi">1185</span><span class="p">,</span> <span class="mi">3225</span><span class="p">,</span> <span class="mi">1270</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">979</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">1239</span><span class="p">,</span> <span class="mi">1763</span><span class="p">,</span> <span class="mi">2672</span><span class="p">,</span> <span class="mi">3951</span><span class="p">,</span> <span class="mi">984</span><span class="p">,</span> <span class="mi">869</span><span class="p">,</span> <span class="mi">3897</span><span class="p">,</span> <span class="mi">327</span><span class="p">,</span> <span class="mi">912</span><span class="p">,</span> <span class="mi">1826</span><span class="p">,</span> 
	<span class="mi">3354</span><span class="p">,</span> <span class="mi">1485</span><span class="p">,</span> <span class="mi">2942</span><span class="p">,</span> <span class="mi">746</span><span class="p">,</span> <span class="mi">833</span><span class="p">,</span> <span class="mi">3968</span><span class="p">,</span> <span class="mi">1437</span><span class="p">,</span> <span class="mi">3590</span><span class="p">,</span> <span class="mi">2151</span><span class="p">,</span> <span class="mi">1523</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">164</span><span class="p">,</span> <span class="mi">3119</span><span class="p">,</span> <span class="mi">1161</span><span class="p">,</span> <span class="mi">3804</span><span class="p">,</span> <span class="mi">1850</span><span class="p">,</span> <span class="mi">3027</span><span class="p">,</span> <span class="mi">1715</span><span class="p">,</span> 
	<span class="mi">3847</span><span class="p">,</span> <span class="mi">2407</span><span class="p">,</span> <span class="mi">2549</span><span class="p">,</span> <span class="mi">467</span><span class="p">,</span> <span class="mi">2029</span><span class="p">,</span> <span class="mi">2808</span><span class="p">,</span> <span class="mi">1782</span><span class="p">,</span> <span class="mi">1134</span><span class="p">,</span> <span class="mi">1953</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">1406</span><span class="p">,</span> <span class="mi">3828</span><span class="p">,</span> <span class="mi">1277</span><span class="p">,</span> <span class="mi">2864</span><span class="p">,</span> <span class="mi">2392</span><span class="p">,</span> <span class="mi">3458</span><span class="p">,</span> <span class="mi">2877</span><span class="p">,</span> <span class="mi">1851</span><span class="p">,</span> 
	<span class="mi">1033</span><span class="p">,</span> <span class="mi">798</span><span class="p">,</span> <span class="mi">2187</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">2800</span><span class="p">,</span> <span class="mi">890</span><span class="p">,</span> <span class="mi">3759</span><span class="p">,</span> <span class="mi">4085</span><span class="p">,</span> <span class="mi">3801</span><span class="p">,</span> <span class="mi">3128</span><span class="p">,</span> <span class="mi">3788</span><span class="p">,</span> <span class="mi">2926</span><span class="p">,</span> <span class="mi">1983</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">2173</span><span class="p">,</span> <span class="mi">2579</span><span class="p">,</span> <span class="mi">904</span><span class="p">,</span> <span class="mi">1019</span><span class="p">,</span> 
	<span class="mi">2108</span><span class="p">,</span> <span class="mi">3054</span><span class="p">,</span> <span class="mi">284</span><span class="p">,</span> <span class="mi">2428</span><span class="p">,</span> <span class="mi">2371</span><span class="p">,</span> <span class="mi">2045</span><span class="p">,</span> <span class="mi">907</span><span class="p">,</span> <span class="mi">1379</span><span class="p">,</span> <span class="mi">2367</span><span class="p">,</span> <span class="mi">351</span><span class="p">,</span> <span class="mi">3678</span><span class="p">,</span> <span class="mi">1087</span><span class="p">,</span> <span class="mi">2821</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="mi">1783</span><span class="p">,</span> <span class="mi">1993</span><span class="p">,</span> <span class="mi">3183</span><span class="p">,</span> <span class="mi">1317</span><span class="p">,</span> 
	<span class="mi">2726</span><span class="p">,</span> <span class="mi">2609</span><span class="p">,</span> <span class="mi">1255</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">2415</span><span class="p">,</span> <span class="mi">2498</span><span class="p">,</span> <span class="mi">721</span><span class="p">,</span> <span class="mi">668</span><span class="p">,</span> <span class="mi">355</span><span class="p">,</span> <span class="mi">94</span><span class="p">,</span> <span class="mi">1997</span><span class="p">,</span> <span class="mi">2609</span><span class="p">,</span> <span class="mi">1945</span><span class="p">,</span> <span class="mi">3011</span><span class="p">,</span> <span class="mi">2405</span><span class="p">,</span> <span class="mi">713</span><span class="p">,</span> <span class="mi">2811</span><span class="p">,</span> <span class="mi">4076</span><span class="p">,</span> 
	<span class="mi">2367</span><span class="p">,</span> <span class="mi">3218</span><span class="p">,</span> <span class="mi">1353</span><span class="p">,</span> <span class="mi">3957</span><span class="p">,</span> <span class="mi">2056</span><span class="p">,</span> <span class="mi">881</span><span class="p">,</span> <span class="mi">3420</span><span class="p">,</span> <span class="mi">1994</span><span class="p">,</span> <span class="mi">1329</span><span class="p">,</span> <span class="mi">892</span><span class="p">,</span> <span class="mi">1577</span><span class="p">,</span> <span class="mi">688</span><span class="p">,</span> <span class="mi">134</span><span class="p">,</span> <span class="mi">371</span><span class="p">,</span> <span class="mi">774</span><span class="p">,</span> <span class="mi">3855</span><span class="p">,</span> <span class="mi">1461</span><span class="p">,</span> <span class="mi">1536</span><span class="p">,</span> 
	<span class="mi">1824</span><span class="p">,</span> <span class="mi">1164</span><span class="p">,</span> <span class="mi">1675</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">1267</span><span class="p">,</span> <span class="mi">3652</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">3816</span><span class="p">,</span> <span class="mi">3169</span><span class="p">,</span> <span class="mi">2116</span><span class="p">,</span> <span class="mi">3930</span><span class="p">,</span> <span class="mi">2979</span><span class="p">,</span> <span class="mi">3166</span><span class="p">,</span> <span class="mi">3944</span><span class="p">,</span> <span class="mi">2252</span><span class="p">,</span> <span class="mi">2988</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">873</span><span class="p">,</span> 
	<span class="mi">1643</span><span class="p">,</span> <span class="mi">1159</span><span class="p">,</span> <span class="mi">2822</span><span class="p">,</span> <span class="mi">1235</span><span class="p">,</span> <span class="mi">2604</span><span class="p">,</span> <span class="mi">888</span><span class="p">,</span> <span class="mi">2036</span><span class="p">,</span> <span class="mi">3053</span><span class="p">,</span> <span class="mi">971</span><span class="p">,</span> <span class="mi">1585</span><span class="p">,</span> <span class="mi">2439</span><span class="p">,</span> <span class="mi">2599</span><span class="p">,</span> <span class="mi">1447</span><span class="p">,</span> <span class="mi">1773</span><span class="p">,</span> <span class="mi">984</span><span class="p">,</span> <span class="mi">261</span><span class="p">,</span> <span class="mi">3233</span><span class="p">,</span> <span class="mi">2861</span><span class="p">,</span> 
	<span class="mi">618</span><span class="p">,</span> <span class="mi">465</span><span class="p">,</span> <span class="mi">3016</span><span class="p">,</span> <span class="mi">3081</span><span class="p">,</span> <span class="mi">1230</span><span class="p">,</span> <span class="mi">1027</span><span class="p">,</span> <span class="mi">3177</span><span class="p">,</span> <span class="mi">459</span><span class="p">,</span> <span class="mi">3041</span><span class="p">,</span> <span class="mi">513</span><span class="p">,</span> <span class="mi">1505</span><span class="p">,</span> <span class="mi">3410</span><span class="p">,</span> <span class="mi">3167</span><span class="p">,</span> <span class="mi">177</span><span class="p">,</span> <span class="mi">958</span><span class="p">,</span> <span class="mi">2118</span><span class="p">,</span> <span class="mi">326</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">2663</span><span class="p">,</span> 
	<span class="mi">2026</span><span class="p">,</span> <span class="mi">2549</span><span class="p">,</span> <span class="mi">3026</span><span class="p">,</span> <span class="mi">2364</span><span class="p">,</span> <span class="mi">1540</span><span class="p">,</span> <span class="mi">3236</span><span class="p">,</span> <span class="mi">2644</span><span class="p">,</span> <span class="mi">4050</span><span class="p">,</span> <span class="mi">735</span><span class="p">,</span> <span class="mi">280</span><span class="p">,</span> <span class="mi">798</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">3808</span><span class="p">,</span> <span class="mi">2384</span><span class="p">,</span> <span class="mi">3497</span><span class="p">,</span> <span class="mi">1759</span><span class="p">,</span> <span class="mi">2415</span><span class="p">,</span> <span class="mi">3444</span><span class="p">,</span> 
	<span class="mi">1562</span><span class="p">,</span> <span class="mi">3472</span><span class="p">,</span> <span class="mi">1151</span><span class="p">,</span> <span class="mi">1984</span><span class="p">,</span> <span class="mi">2454</span><span class="p">,</span> <span class="mi">3167</span><span class="p">,</span> <span class="mi">1538</span><span class="p">,</span> <span class="mi">941</span><span class="p">,</span> <span class="mi">1561</span><span class="p">,</span> <span class="mi">3071</span><span class="p">,</span> <span class="mi">845</span><span class="p">,</span> <span class="mi">2824</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">1467</span><span class="p">,</span> <span class="mi">3807</span><span class="p">,</span> <span class="mi">2191</span><span class="p">,</span> <span class="mi">1858</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> 
	<span class="mi">3847</span><span class="p">,</span> <span class="mi">1326</span><span class="p">,</span> <span class="mi">3868</span><span class="p">,</span> <span class="mi">2787</span><span class="p">,</span> <span class="mi">1624</span><span class="p">,</span> <span class="mi">795</span><span class="p">,</span> <span class="mi">3214</span><span class="p">,</span> <span class="mi">1932</span><span class="p">,</span> <span class="mi">3496</span><span class="p">,</span> <span class="mi">457</span><span class="p">,</span> <span class="mi">2595</span><span class="p">,</span> <span class="mi">3043</span><span class="p">,</span> <span class="mi">772</span><span class="p">,</span> <span class="mi">2436</span><span class="p">,</span> <span class="mi">2160</span><span class="p">,</span> <span class="mi">3428</span><span class="p">,</span> <span class="mi">2005</span><span class="p">,</span> <span class="mi">2597</span><span class="p">,</span> 
	<span class="mi">1932</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">3528</span><span class="p">,</span> <span class="mi">1698</span><span class="p">,</span> <span class="mi">3663</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">3298</span><span class="p">,</span> <span class="mi">1872</span><span class="p">,</span> <span class="mi">1179</span><span class="p">,</span> <span class="mi">3987</span><span class="p">,</span> <span class="mi">3695</span><span class="p">,</span> <span class="mi">3561</span><span class="p">,</span> <span class="mi">1762</span><span class="p">,</span> <span class="mi">3785</span><span class="p">,</span> <span class="mi">3005</span><span class="p">,</span> <span class="mi">2574</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1524</span><span class="p">,</span> 
	<span class="mi">2738</span><span class="p">,</span> <span class="mi">1753</span><span class="p">,</span> <span class="mi">2350</span><span class="p">,</span> <span class="mi">558</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">3782</span><span class="p">,</span> <span class="mi">722</span><span class="p">,</span> <span class="mi">886</span><span class="p">,</span> <span class="mi">2176</span><span class="p">,</span> <span class="mi">3050</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">1925</span><span class="p">,</span> <span class="mi">564</span><span class="p">,</span> <span class="mi">1271</span><span class="p">,</span> <span class="mi">2535</span><span class="p">,</span> <span class="mi">3113</span><span class="p">,</span> <span class="mi">1310</span><span class="p">,</span> <span class="mi">2098</span><span class="p">,</span> 
	<span class="mi">3011</span><span class="p">,</span> <span class="mi">964</span><span class="p">,</span> <span class="mi">3281</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1326</span><span class="p">,</span> <span class="mi">741</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">2632</span><span class="p">,</span> <span class="mi">373</span><span class="p">,</span> <span class="mi">1176</span><span class="p">,</span> <span class="mi">548</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">1445</span><span class="p">,</span> <span class="mi">2376</span><span class="p">,</span> <span class="mi">1524</span><span class="p">,</span> <span class="mi">2690</span><span class="p">,</span> <span class="mi">1316</span><span class="p">,</span> <span class="mi">2304</span><span class="p">,</span> <span class="mi">1336</span><span class="p">,</span> 
	<span class="mi">2257</span><span class="p">,</span> <span class="mi">3227</span><span class="p">,</span> <span class="mi">2542</span><span class="p">,</span> <span class="mi">3911</span><span class="p">,</span> <span class="mi">3460</span>
	<span class="p">]</span>

	<span class="n">LTC</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
	<span class="n">LTC</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">IVK</span>

	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span> <span class="o">//</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
			<span class="n">LTC</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">roll</span><span class="p">(</span><span class="n">IVK</span><span class="p">[</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
		<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="s">"Give me your salt: "</span><span class="p">)</span>
		<span class="n">SALT</span> <span class="o">=</span> <span class="n">sc</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">SALT</span> <span class="o">=</span> <span class="n">pad</span><span class="p">(</span><span class="n">SALT</span><span class="p">,</span> <span class="n">m</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>
		<span class="n">MASKED_FLAG</span> <span class="o">=</span> <span class="n">chaffy_mask</span><span class="p">(</span><span class="n">SALT</span><span class="p">,</span> <span class="n">LTC</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
		<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="sa">f</span><span class="s">'masked_flag = </span><span class="si">{</span><span class="n">MASKED_FLAG</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
	<span class="n">main</span><span class="p">()</span>
</pre></table></code></div></div><h3 file="chaffymasking.py" id="solve-1">solve</h3><p>気にすべきなのは、ランダムが入る部分の以下の二か所</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="chaffymasking.py"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">pad</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
	<span class="n">result</span> <span class="o">=</span> <span class="n">inp</span> <span class="o">+</span> <span class="n">os</span><span class="p">.</span><span class="n">urandom</span><span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">))</span>
	<span class="k">return</span> <span class="n">result</span>
	
<span class="c1"># line 33
</span><span class="n">xor_salts</span> <span class="o">=</span> <span class="nb">int</span><span class="p">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">byte_xor</span><span class="p">(</span><span class="n">half1_salt</span><span class="p">,</span> <span class="n">half2_salt</span><span class="p">),</span> <span class="s">"big"</span><span class="p">)</span>
<span class="k">if</span> <span class="n">xor_salts</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">half1_salt</span> <span class="o">=</span> <span class="n">byte_xor</span><span class="p">(</span><span class="n">half1_salt</span><span class="p">,</span> <span class="n">os</span><span class="p">.</span><span class="n">urandom</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
</pre></table></code></div></div><p>pad関数は$length = len(inp)$でランダム性が消去でき、xor_saltsは $half1salt \neq half2salt$にすればいい。</p><p>あとはMITHみたく上から$out1 ,out2$が、下から$maskedflag$が求まるので順に逆算して以下のxorで答えを出せばいい</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">masked_flag</span> <span class="o">=</span> <span class="p">(</span><span class="n">flag_vector</span> <span class="o">^</span> <span class="n">out_1</span> <span class="o">^</span> <span class="n">out_2</span><span class="p">)</span> <span class="o">%</span> <span class="mi">256</span>
</pre></table></code></div></div><p>ただ、なんで5回もリクエストを受付してるのか…</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">binascii</span>
<span class="kn">import</span> <span class="nn">os</span><span class="p">,</span> <span class="n">sys</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>


<span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">"65.21.255.31"</span> <span class="p">,</span><span class="mi">31377</span><span class="p">)</span>
<span class="c1"># io = process(["python3",'chaffymasking.py'])
</span><span class="n">io</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"| Gi"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="n">slt</span><span class="p">):</span>
    <span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
    <span class="n">io</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">slt</span><span class="p">)</span>
    <span class="c1"># print(io.recvline())
</span>    <span class="c1"># io.interactive()
</span>    <span class="n">masked_flag</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">(</span><span class="bp">None</span><span class="p">).</span><span class="n">decode</span><span class="p">()[</span><span class="mi">16</span><span class="p">:])</span>
    <span class="k">return</span> <span class="n">masked_flag</span>

<span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">64</span> 
<span class="n">IVK</span> <span class="o">=</span> <span class="p">[</span>
	<span class="mi">3826</span><span class="p">,</span> <span class="mi">476</span><span class="p">,</span> <span class="mi">3667</span><span class="p">,</span> <span class="mi">2233</span><span class="p">,</span> <span class="mi">1239</span><span class="p">,</span> <span class="mi">1166</span><span class="p">,</span> <span class="mi">2119</span><span class="p">,</span> <span class="mi">2559</span><span class="p">,</span> <span class="mi">2376</span><span class="p">,</span> <span class="mi">1208</span><span class="p">,</span> <span class="mi">2165</span><span class="p">,</span> <span class="mi">2897</span><span class="p">,</span> <span class="mi">830</span><span class="p">,</span> <span class="mi">529</span><span class="p">,</span> <span class="mi">346</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">2188</span><span class="p">,</span> <span class="mi">4025</span><span class="p">,</span> 
	<span class="mi">3667</span><span class="p">,</span> <span class="mi">1829</span><span class="p">,</span> <span class="mi">3987</span><span class="p">,</span> <span class="mi">952</span><span class="p">,</span> <span class="mi">3860</span><span class="p">,</span> <span class="mi">2574</span><span class="p">,</span> <span class="mi">959</span><span class="p">,</span> <span class="mi">1394</span><span class="p">,</span> <span class="mi">1481</span><span class="p">,</span> <span class="mi">2822</span><span class="p">,</span> <span class="mi">3794</span><span class="p">,</span> <span class="mi">2950</span><span class="p">,</span> <span class="mi">1190</span><span class="p">,</span> <span class="mi">777</span><span class="p">,</span> <span class="mi">604</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">710</span><span class="p">,</span> <span class="mi">1765</span><span class="p">,</span> 
	<span class="mi">3752</span><span class="p">,</span> <span class="mi">2970</span><span class="p">,</span> <span class="mi">952</span><span class="p">,</span> <span class="mi">803</span><span class="p">,</span> <span class="mi">873</span><span class="p">,</span> <span class="mi">2647</span><span class="p">,</span> <span class="mi">2643</span><span class="p">,</span> <span class="mi">1096</span><span class="p">,</span> <span class="mi">1202</span><span class="p">,</span> <span class="mi">2236</span><span class="p">,</span> <span class="mi">1492</span><span class="p">,</span> <span class="mi">3372</span><span class="p">,</span> <span class="mi">2106</span><span class="p">,</span> <span class="mi">1868</span><span class="p">,</span> <span class="mi">535</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">3143</span><span class="p">,</span> <span class="mi">3370</span><span class="p">,</span> 
	<span class="mi">1</span><span class="p">,</span> <span class="mi">1643</span><span class="p">,</span> <span class="mi">2147</span><span class="p">,</span> <span class="mi">2368</span><span class="p">,</span> <span class="mi">3961</span><span class="p">,</span> <span class="mi">1339</span><span class="p">,</span> <span class="mi">552</span><span class="p">,</span> <span class="mi">2641</span><span class="p">,</span> <span class="mi">3222</span><span class="p">,</span> <span class="mi">2505</span><span class="p">,</span> <span class="mi">3449</span><span class="p">,</span> <span class="mi">1540</span><span class="p">,</span> <span class="mi">2024</span><span class="p">,</span> <span class="mi">618</span><span class="p">,</span> <span class="mi">1904</span><span class="p">,</span> <span class="mi">314</span><span class="p">,</span> <span class="mi">1306</span><span class="p">,</span> <span class="mi">3173</span><span class="p">,</span> 
	<span class="mi">4040</span><span class="p">,</span> <span class="mi">1488</span><span class="p">,</span> <span class="mi">1339</span><span class="p">,</span> <span class="mi">2545</span><span class="p">,</span> <span class="mi">2167</span><span class="p">,</span> <span class="mi">394</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">3169</span><span class="p">,</span> <span class="mi">897</span><span class="p">,</span> <span class="mi">4085</span><span class="p">,</span> <span class="mi">4067</span><span class="p">,</span> <span class="mi">3461</span><span class="p">,</span> <span class="mi">3444</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">3185</span><span class="p">,</span> <span class="mi">2267</span><span class="p">,</span> <span class="mi">3239</span><span class="p">,</span> <span class="mi">3612</span><span class="p">,</span> 
	<span class="mi">2775</span><span class="p">,</span> <span class="mi">580</span><span class="p">,</span> <span class="mi">3579</span><span class="p">,</span> <span class="mi">3623</span><span class="p">,</span> <span class="mi">1721</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">650</span><span class="p">,</span> <span class="mi">2755</span><span class="p">,</span> <span class="mi">1434</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">3167</span><span class="p">,</span> <span class="mi">323</span><span class="p">,</span> <span class="mi">589</span><span class="p">,</span> <span class="mi">3410</span><span class="p">,</span> <span class="mi">652</span><span class="p">,</span> <span class="mi">2746</span><span class="p">,</span> <span class="mi">2787</span><span class="p">,</span> <span class="mi">3665</span><span class="p">,</span> <span class="mi">828</span><span class="p">,</span> 
	<span class="mi">3200</span><span class="p">,</span> <span class="mi">1450</span><span class="p">,</span> <span class="mi">3147</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">3741</span><span class="p">,</span> <span class="mi">1055</span><span class="p">,</span> <span class="mi">505</span><span class="p">,</span> <span class="mi">2929</span><span class="p">,</span> <span class="mi">1423</span><span class="p">,</span> <span class="mi">3629</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1269</span><span class="p">,</span> <span class="mi">4066</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">2432</span><span class="p">,</span> <span class="mi">3306</span><span class="p">,</span> <span class="mi">4015</span><span class="p">,</span> <span class="mi">2350</span><span class="p">,</span> 
	<span class="mi">2154</span><span class="p">,</span> <span class="mi">2623</span><span class="p">,</span> <span class="mi">1304</span><span class="p">,</span> <span class="mi">493</span><span class="p">,</span> <span class="mi">763</span><span class="p">,</span> <span class="mi">1765</span><span class="p">,</span> <span class="mi">2608</span><span class="p">,</span> <span class="mi">695</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">2462</span><span class="p">,</span> <span class="mi">294</span><span class="p">,</span> <span class="mi">3656</span><span class="p">,</span> <span class="mi">3231</span><span class="p">,</span> <span class="mi">3647</span><span class="p">,</span> <span class="mi">3776</span><span class="p">,</span> <span class="mi">3457</span><span class="p">,</span> <span class="mi">2285</span><span class="p">,</span> <span class="mi">2992</span><span class="p">,</span> 
	<span class="mi">3997</span><span class="p">,</span> <span class="mi">603</span><span class="p">,</span> <span class="mi">2342</span><span class="p">,</span> <span class="mi">2283</span><span class="p">,</span> <span class="mi">3029</span><span class="p">,</span> <span class="mi">3299</span><span class="p">,</span> <span class="mi">1690</span><span class="p">,</span> <span class="mi">3281</span><span class="p">,</span> <span class="mi">3568</span><span class="p">,</span> <span class="mi">1927</span><span class="p">,</span> <span class="mi">2909</span><span class="p">,</span> <span class="mi">1797</span><span class="p">,</span> <span class="mi">1675</span><span class="p">,</span> <span class="mi">3245</span><span class="p">,</span> <span class="mi">2604</span><span class="p">,</span> <span class="mi">1272</span><span class="p">,</span> <span class="mi">1146</span><span class="p">,</span> 
	<span class="mi">3301</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">3712</span><span class="p">,</span> <span class="mi">2691</span><span class="p">,</span> <span class="mi">1097</span><span class="p">,</span> <span class="mi">1396</span><span class="p">,</span> <span class="mi">3694</span><span class="p">,</span> <span class="mi">3866</span><span class="p">,</span> <span class="mi">2066</span><span class="p">,</span> <span class="mi">1946</span><span class="p">,</span> <span class="mi">3476</span><span class="p">,</span> <span class="mi">1182</span><span class="p">,</span> <span class="mi">3409</span><span class="p">,</span> <span class="mi">3510</span><span class="p">,</span> <span class="mi">2920</span><span class="p">,</span> <span class="mi">2743</span><span class="p">,</span> <span class="mi">1126</span><span class="p">,</span> <span class="mi">2154</span><span class="p">,</span> 
	<span class="mi">3447</span><span class="p">,</span> <span class="mi">1442</span><span class="p">,</span> <span class="mi">2021</span><span class="p">,</span> <span class="mi">1748</span><span class="p">,</span> <span class="mi">1075</span><span class="p">,</span> <span class="mi">1439</span><span class="p">,</span> <span class="mi">3932</span><span class="p">,</span> <span class="mi">3438</span><span class="p">,</span> <span class="mi">781</span><span class="p">,</span> <span class="mi">1478</span><span class="p">,</span> <span class="mi">1708</span><span class="p">,</span> <span class="mi">461</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">1881</span><span class="p">,</span> <span class="mi">1353</span><span class="p">,</span> <span class="mi">2959</span><span class="p">,</span> <span class="mi">1225</span><span class="p">,</span> <span class="mi">1923</span><span class="p">,</span> 
	<span class="mi">1414</span><span class="p">,</span> <span class="mi">4046</span><span class="p">,</span> <span class="mi">3416</span><span class="p">,</span> <span class="mi">2845</span><span class="p">,</span> <span class="mi">1498</span><span class="p">,</span> <span class="mi">4036</span><span class="p">,</span> <span class="mi">3899</span><span class="p">,</span> <span class="mi">3878</span><span class="p">,</span> <span class="mi">766</span><span class="p">,</span> <span class="mi">3975</span><span class="p">,</span> <span class="mi">1355</span><span class="p">,</span> <span class="mi">2602</span><span class="p">,</span> <span class="mi">3588</span><span class="p">,</span> <span class="mi">3508</span><span class="p">,</span> <span class="mi">3660</span><span class="p">,</span> <span class="mi">3237</span><span class="p">,</span> <span class="mi">3018</span><span class="p">,</span> 
	<span class="mi">1619</span><span class="p">,</span> <span class="mi">2797</span><span class="p">,</span> <span class="mi">1823</span><span class="p">,</span> <span class="mi">1185</span><span class="p">,</span> <span class="mi">3225</span><span class="p">,</span> <span class="mi">1270</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">979</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">1239</span><span class="p">,</span> <span class="mi">1763</span><span class="p">,</span> <span class="mi">2672</span><span class="p">,</span> <span class="mi">3951</span><span class="p">,</span> <span class="mi">984</span><span class="p">,</span> <span class="mi">869</span><span class="p">,</span> <span class="mi">3897</span><span class="p">,</span> <span class="mi">327</span><span class="p">,</span> <span class="mi">912</span><span class="p">,</span> <span class="mi">1826</span><span class="p">,</span> 
	<span class="mi">3354</span><span class="p">,</span> <span class="mi">1485</span><span class="p">,</span> <span class="mi">2942</span><span class="p">,</span> <span class="mi">746</span><span class="p">,</span> <span class="mi">833</span><span class="p">,</span> <span class="mi">3968</span><span class="p">,</span> <span class="mi">1437</span><span class="p">,</span> <span class="mi">3590</span><span class="p">,</span> <span class="mi">2151</span><span class="p">,</span> <span class="mi">1523</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">164</span><span class="p">,</span> <span class="mi">3119</span><span class="p">,</span> <span class="mi">1161</span><span class="p">,</span> <span class="mi">3804</span><span class="p">,</span> <span class="mi">1850</span><span class="p">,</span> <span class="mi">3027</span><span class="p">,</span> <span class="mi">1715</span><span class="p">,</span> 
	<span class="mi">3847</span><span class="p">,</span> <span class="mi">2407</span><span class="p">,</span> <span class="mi">2549</span><span class="p">,</span> <span class="mi">467</span><span class="p">,</span> <span class="mi">2029</span><span class="p">,</span> <span class="mi">2808</span><span class="p">,</span> <span class="mi">1782</span><span class="p">,</span> <span class="mi">1134</span><span class="p">,</span> <span class="mi">1953</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">1406</span><span class="p">,</span> <span class="mi">3828</span><span class="p">,</span> <span class="mi">1277</span><span class="p">,</span> <span class="mi">2864</span><span class="p">,</span> <span class="mi">2392</span><span class="p">,</span> <span class="mi">3458</span><span class="p">,</span> <span class="mi">2877</span><span class="p">,</span> <span class="mi">1851</span><span class="p">,</span> 
	<span class="mi">1033</span><span class="p">,</span> <span class="mi">798</span><span class="p">,</span> <span class="mi">2187</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">2800</span><span class="p">,</span> <span class="mi">890</span><span class="p">,</span> <span class="mi">3759</span><span class="p">,</span> <span class="mi">4085</span><span class="p">,</span> <span class="mi">3801</span><span class="p">,</span> <span class="mi">3128</span><span class="p">,</span> <span class="mi">3788</span><span class="p">,</span> <span class="mi">2926</span><span class="p">,</span> <span class="mi">1983</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">2173</span><span class="p">,</span> <span class="mi">2579</span><span class="p">,</span> <span class="mi">904</span><span class="p">,</span> <span class="mi">1019</span><span class="p">,</span> 
	<span class="mi">2108</span><span class="p">,</span> <span class="mi">3054</span><span class="p">,</span> <span class="mi">284</span><span class="p">,</span> <span class="mi">2428</span><span class="p">,</span> <span class="mi">2371</span><span class="p">,</span> <span class="mi">2045</span><span class="p">,</span> <span class="mi">907</span><span class="p">,</span> <span class="mi">1379</span><span class="p">,</span> <span class="mi">2367</span><span class="p">,</span> <span class="mi">351</span><span class="p">,</span> <span class="mi">3678</span><span class="p">,</span> <span class="mi">1087</span><span class="p">,</span> <span class="mi">2821</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="mi">1783</span><span class="p">,</span> <span class="mi">1993</span><span class="p">,</span> <span class="mi">3183</span><span class="p">,</span> <span class="mi">1317</span><span class="p">,</span> 
	<span class="mi">2726</span><span class="p">,</span> <span class="mi">2609</span><span class="p">,</span> <span class="mi">1255</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">2415</span><span class="p">,</span> <span class="mi">2498</span><span class="p">,</span> <span class="mi">721</span><span class="p">,</span> <span class="mi">668</span><span class="p">,</span> <span class="mi">355</span><span class="p">,</span> <span class="mi">94</span><span class="p">,</span> <span class="mi">1997</span><span class="p">,</span> <span class="mi">2609</span><span class="p">,</span> <span class="mi">1945</span><span class="p">,</span> <span class="mi">3011</span><span class="p">,</span> <span class="mi">2405</span><span class="p">,</span> <span class="mi">713</span><span class="p">,</span> <span class="mi">2811</span><span class="p">,</span> <span class="mi">4076</span><span class="p">,</span> 
	<span class="mi">2367</span><span class="p">,</span> <span class="mi">3218</span><span class="p">,</span> <span class="mi">1353</span><span class="p">,</span> <span class="mi">3957</span><span class="p">,</span> <span class="mi">2056</span><span class="p">,</span> <span class="mi">881</span><span class="p">,</span> <span class="mi">3420</span><span class="p">,</span> <span class="mi">1994</span><span class="p">,</span> <span class="mi">1329</span><span class="p">,</span> <span class="mi">892</span><span class="p">,</span> <span class="mi">1577</span><span class="p">,</span> <span class="mi">688</span><span class="p">,</span> <span class="mi">134</span><span class="p">,</span> <span class="mi">371</span><span class="p">,</span> <span class="mi">774</span><span class="p">,</span> <span class="mi">3855</span><span class="p">,</span> <span class="mi">1461</span><span class="p">,</span> <span class="mi">1536</span><span class="p">,</span> 
	<span class="mi">1824</span><span class="p">,</span> <span class="mi">1164</span><span class="p">,</span> <span class="mi">1675</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">1267</span><span class="p">,</span> <span class="mi">3652</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">3816</span><span class="p">,</span> <span class="mi">3169</span><span class="p">,</span> <span class="mi">2116</span><span class="p">,</span> <span class="mi">3930</span><span class="p">,</span> <span class="mi">2979</span><span class="p">,</span> <span class="mi">3166</span><span class="p">,</span> <span class="mi">3944</span><span class="p">,</span> <span class="mi">2252</span><span class="p">,</span> <span class="mi">2988</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">873</span><span class="p">,</span> 
	<span class="mi">1643</span><span class="p">,</span> <span class="mi">1159</span><span class="p">,</span> <span class="mi">2822</span><span class="p">,</span> <span class="mi">1235</span><span class="p">,</span> <span class="mi">2604</span><span class="p">,</span> <span class="mi">888</span><span class="p">,</span> <span class="mi">2036</span><span class="p">,</span> <span class="mi">3053</span><span class="p">,</span> <span class="mi">971</span><span class="p">,</span> <span class="mi">1585</span><span class="p">,</span> <span class="mi">2439</span><span class="p">,</span> <span class="mi">2599</span><span class="p">,</span> <span class="mi">1447</span><span class="p">,</span> <span class="mi">1773</span><span class="p">,</span> <span class="mi">984</span><span class="p">,</span> <span class="mi">261</span><span class="p">,</span> <span class="mi">3233</span><span class="p">,</span> <span class="mi">2861</span><span class="p">,</span> 
	<span class="mi">618</span><span class="p">,</span> <span class="mi">465</span><span class="p">,</span> <span class="mi">3016</span><span class="p">,</span> <span class="mi">3081</span><span class="p">,</span> <span class="mi">1230</span><span class="p">,</span> <span class="mi">1027</span><span class="p">,</span> <span class="mi">3177</span><span class="p">,</span> <span class="mi">459</span><span class="p">,</span> <span class="mi">3041</span><span class="p">,</span> <span class="mi">513</span><span class="p">,</span> <span class="mi">1505</span><span class="p">,</span> <span class="mi">3410</span><span class="p">,</span> <span class="mi">3167</span><span class="p">,</span> <span class="mi">177</span><span class="p">,</span> <span class="mi">958</span><span class="p">,</span> <span class="mi">2118</span><span class="p">,</span> <span class="mi">326</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">2663</span><span class="p">,</span> 
	<span class="mi">2026</span><span class="p">,</span> <span class="mi">2549</span><span class="p">,</span> <span class="mi">3026</span><span class="p">,</span> <span class="mi">2364</span><span class="p">,</span> <span class="mi">1540</span><span class="p">,</span> <span class="mi">3236</span><span class="p">,</span> <span class="mi">2644</span><span class="p">,</span> <span class="mi">4050</span><span class="p">,</span> <span class="mi">735</span><span class="p">,</span> <span class="mi">280</span><span class="p">,</span> <span class="mi">798</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">3808</span><span class="p">,</span> <span class="mi">2384</span><span class="p">,</span> <span class="mi">3497</span><span class="p">,</span> <span class="mi">1759</span><span class="p">,</span> <span class="mi">2415</span><span class="p">,</span> <span class="mi">3444</span><span class="p">,</span> 
	<span class="mi">1562</span><span class="p">,</span> <span class="mi">3472</span><span class="p">,</span> <span class="mi">1151</span><span class="p">,</span> <span class="mi">1984</span><span class="p">,</span> <span class="mi">2454</span><span class="p">,</span> <span class="mi">3167</span><span class="p">,</span> <span class="mi">1538</span><span class="p">,</span> <span class="mi">941</span><span class="p">,</span> <span class="mi">1561</span><span class="p">,</span> <span class="mi">3071</span><span class="p">,</span> <span class="mi">845</span><span class="p">,</span> <span class="mi">2824</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">1467</span><span class="p">,</span> <span class="mi">3807</span><span class="p">,</span> <span class="mi">2191</span><span class="p">,</span> <span class="mi">1858</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> 
	<span class="mi">3847</span><span class="p">,</span> <span class="mi">1326</span><span class="p">,</span> <span class="mi">3868</span><span class="p">,</span> <span class="mi">2787</span><span class="p">,</span> <span class="mi">1624</span><span class="p">,</span> <span class="mi">795</span><span class="p">,</span> <span class="mi">3214</span><span class="p">,</span> <span class="mi">1932</span><span class="p">,</span> <span class="mi">3496</span><span class="p">,</span> <span class="mi">457</span><span class="p">,</span> <span class="mi">2595</span><span class="p">,</span> <span class="mi">3043</span><span class="p">,</span> <span class="mi">772</span><span class="p">,</span> <span class="mi">2436</span><span class="p">,</span> <span class="mi">2160</span><span class="p">,</span> <span class="mi">3428</span><span class="p">,</span> <span class="mi">2005</span><span class="p">,</span> <span class="mi">2597</span><span class="p">,</span> 
	<span class="mi">1932</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">3528</span><span class="p">,</span> <span class="mi">1698</span><span class="p">,</span> <span class="mi">3663</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">3298</span><span class="p">,</span> <span class="mi">1872</span><span class="p">,</span> <span class="mi">1179</span><span class="p">,</span> <span class="mi">3987</span><span class="p">,</span> <span class="mi">3695</span><span class="p">,</span> <span class="mi">3561</span><span class="p">,</span> <span class="mi">1762</span><span class="p">,</span> <span class="mi">3785</span><span class="p">,</span> <span class="mi">3005</span><span class="p">,</span> <span class="mi">2574</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1524</span><span class="p">,</span> 
	<span class="mi">2738</span><span class="p">,</span> <span class="mi">1753</span><span class="p">,</span> <span class="mi">2350</span><span class="p">,</span> <span class="mi">558</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">3782</span><span class="p">,</span> <span class="mi">722</span><span class="p">,</span> <span class="mi">886</span><span class="p">,</span> <span class="mi">2176</span><span class="p">,</span> <span class="mi">3050</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">1925</span><span class="p">,</span> <span class="mi">564</span><span class="p">,</span> <span class="mi">1271</span><span class="p">,</span> <span class="mi">2535</span><span class="p">,</span> <span class="mi">3113</span><span class="p">,</span> <span class="mi">1310</span><span class="p">,</span> <span class="mi">2098</span><span class="p">,</span> 
	<span class="mi">3011</span><span class="p">,</span> <span class="mi">964</span><span class="p">,</span> <span class="mi">3281</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1326</span><span class="p">,</span> <span class="mi">741</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">2632</span><span class="p">,</span> <span class="mi">373</span><span class="p">,</span> <span class="mi">1176</span><span class="p">,</span> <span class="mi">548</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">1445</span><span class="p">,</span> <span class="mi">2376</span><span class="p">,</span> <span class="mi">1524</span><span class="p">,</span> <span class="mi">2690</span><span class="p">,</span> <span class="mi">1316</span><span class="p">,</span> <span class="mi">2304</span><span class="p">,</span> <span class="mi">1336</span><span class="p">,</span> 
	<span class="mi">2257</span><span class="p">,</span> <span class="mi">3227</span><span class="p">,</span> <span class="mi">2542</span><span class="p">,</span> <span class="mi">3911</span><span class="p">,</span> <span class="mi">3460</span>
	<span class="p">]</span>

<span class="n">LTC</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
<span class="n">LTC</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">IVK</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
	<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span> <span class="o">//</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
		<span class="n">LTC</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">roll</span><span class="p">(</span><span class="n">IVK</span><span class="p">[</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">byte_xor</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
	<span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">_a</span> <span class="o">^</span> <span class="n">_b</span> <span class="k">for</span> <span class="n">_a</span><span class="p">,</span><span class="n">_b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">))</span> 

<span class="k">def</span> <span class="nf">pad</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
	<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span> <span class="o">==</span> <span class="n">length</span>
	<span class="n">result</span> <span class="o">=</span> <span class="n">inp</span> <span class="o">+</span> <span class="n">os</span><span class="p">.</span><span class="n">urandom</span><span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">))</span>
	<span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">make_chaffy_mask</span><span class="p">(</span><span class="n">salt</span><span class="p">,</span> <span class="n">LTC</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
	<span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span>
	<span class="n">half1_salt</span> <span class="o">=</span> <span class="n">salt</span><span class="p">[:</span><span class="n">m</span> <span class="o">//</span> <span class="mi">8</span><span class="p">]</span>
	<span class="n">half2_salt</span> <span class="o">=</span> <span class="n">salt</span><span class="p">[</span><span class="n">m</span> <span class="o">//</span> <span class="mi">8</span><span class="p">:]</span>
	<span class="n">xor_salts</span> <span class="o">=</span> <span class="nb">int</span><span class="p">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">byte_xor</span><span class="p">(</span><span class="n">half1_salt</span><span class="p">,</span> <span class="n">half2_salt</span><span class="p">),</span> <span class="s">"big"</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">xor_salts</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">return</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span>
		<span class="c1"># half1_salt = byte_xor(half1_salt, os.urandom(m))
</span>	<span class="n">half1_binStr</span> <span class="o">=</span> <span class="s">"{:08b}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">half1_salt</span><span class="p">.</span><span class="nb">hex</span><span class="p">(),</span><span class="mi">16</span><span class="p">))</span>
	<span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">half1_binStr</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">):</span>
		<span class="n">half1_binStr</span> <span class="o">=</span> <span class="s">"0"</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">half1_binStr</span><span class="p">)</span><span class="o">%</span><span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">half1_binStr</span>
	<span class="n">half2_binStr</span> <span class="o">=</span> <span class="s">"{:08b}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">half2_salt</span><span class="p">.</span><span class="nb">hex</span><span class="p">(),</span><span class="mi">16</span><span class="p">))</span>
	<span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">half2_binStr</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">):</span>
		<span class="n">half2_binStr</span> <span class="o">=</span> <span class="s">"0"</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">half2_binStr</span><span class="p">)</span><span class="o">%</span><span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">half2_binStr</span>
	
	<span class="n">vec_1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">half1_binStr</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
	<span class="n">vec_1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">vec_1</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
	<span class="n">vec_2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">half2_binStr</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
	<span class="n">vec_2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">vec_2</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
	
	<span class="n">out_1</span> <span class="o">=</span> <span class="n">LTC</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vec_1</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span>
	<span class="n">out_2</span> <span class="o">=</span> <span class="n">LTC</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vec_2</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span>
	<span class="k">return</span> <span class="n">out_1</span><span class="p">,</span> <span class="n">out_2</span>

<span class="k">def</span> <span class="nf">mith</span><span class="p">(</span><span class="n">mask_enc</span><span class="p">,</span><span class="n">out1</span><span class="p">,</span><span class="n">out2</span><span class="p">):</span>
	<span class="n">enc</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">mask_enc</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">):</span>
		<span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">mask_enc</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>	
		<span class="n">tmp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mask_enc</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)],</span><span class="mi">16</span><span class="p">)</span>
		<span class="n">enc</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
	<span class="n">enc_vector</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span>
	<span class="n">enc_vector</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">enc_vector</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
	<span class="n">ans_vec</span> <span class="o">=</span> <span class="p">(</span><span class="n">enc_vector</span><span class="o">^</span><span class="n">out1</span><span class="o">^</span><span class="n">out2</span><span class="p">)</span><span class="o">%</span><span class="mi">256</span>
	<span class="n">ans_vec</span> <span class="o">=</span>  <span class="n">np</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ans_vec</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">))</span>
	<span class="n">ans</span> <span class="o">=</span> <span class="p">[</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ans_vec</span><span class="p">]</span>
	<span class="k">print</span><span class="p">(</span><span class="s">""</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">ans</span><span class="p">))</span>

<span class="n">SALT</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">urandom</span><span class="p">(</span><span class="n">m</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">salt</span> <span class="o">=</span> <span class="n">pad</span><span class="p">(</span><span class="n">SALT</span><span class="p">,</span> <span class="n">m</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">out1</span><span class="p">,</span><span class="n">out2</span> <span class="o">=</span> <span class="n">make_chaffy_mask</span><span class="p">(</span><span class="n">salt</span><span class="p">,</span> <span class="n">LTC</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">enc</span> <span class="o">=</span> <span class="n">send</span><span class="p">(</span><span class="n">SALT</span><span class="p">)</span>
<span class="n">mith</span><span class="p">(</span><span class="n">enc</span><span class="p">.</span><span class="n">decode</span><span class="p">(),</span><span class="n">out1</span><span class="p">,</span><span class="n">out2</span><span class="p">)</span>

<span class="c1"># ASIS{Lattice_based_hash_collision_it_was_sooooooooooooooo_easY!}
</span>


</pre></table></code></div></div><h2 file="solve.py" id="crypto-mariana-56-solve">[crypto] Mariana [56 solve]</h2><h3 id="chall-2"><span class="mr-2">chall</span><a href="#chall-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="solve.py"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="c1"># from flag import flag
</span>
<span class="k">def</span> <span class="nf">die</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
	<span class="n">pr</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
	<span class="n">quit</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">pr</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
	<span class="n">s</span> <span class="o">=</span> <span class="s">" "</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">args</span><span class="p">))</span>
	<span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
	<span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">flush</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">sc</span><span class="p">():</span>
	<span class="k">return</span> <span class="n">sys</span><span class="p">.</span><span class="n">stdin</span><span class="p">.</span><span class="nb">buffer</span><span class="p">.</span><span class="n">readline</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
	<span class="n">border</span> <span class="o">=</span> <span class="s">"|"</span>
	<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="o">*</span><span class="mi">72</span><span class="p">)</span>
	<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="s">"Welcome to MARIANA cryptography battle, the mission is solving super"</span><span class="p">,</span> <span class="n">border</span><span class="p">)</span>
	<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="s">"hard special DLP problem in real world, are you ready to fight?     "</span><span class="p">,</span> <span class="n">border</span><span class="p">)</span>
	<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="o">*</span><span class="mi">72</span><span class="p">)</span>

	<span class="n">NBIT</span> <span class="o">=</span> <span class="mi">32</span>
	<span class="n">STEP</span> <span class="o">=</span> <span class="mi">40</span>

	<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="s">"In each step solve the given equation and send the solution for x.  "</span><span class="p">,</span> <span class="n">border</span><span class="p">)</span>
	<span class="n">c</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="k">while</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="n">STEP</span><span class="p">:</span>
		<span class="n">nbit</span> <span class="o">=</span> <span class="n">NBIT</span> <span class="o">*</span> <span class="n">c</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="n">nbit</span><span class="p">)</span>
		<span class="n">g</span> <span class="o">=</span> <span class="n">getRandomRange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
		<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="sa">f</span><span class="s">'p = </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
		<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="sa">f</span><span class="s">'g = </span><span class="si">{</span><span class="n">g</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
		<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="s">'Send the solution x = '</span><span class="p">)</span>
		<span class="n">ans</span> <span class="o">=</span> <span class="n">sc</span><span class="p">()</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="n">die</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="s">'Given number is not integer!'</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">p</span><span class="p">:</span>
			<span class="n">die</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="s">"Kidding me!? Your solution must be smaller than p :P"</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">STEP</span><span class="p">:</span>
				<span class="n">die</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="sa">f</span><span class="s">"Congratz! the flag is: </span><span class="si">{</span><span class="n">flag</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="s">"Good job, try to solve the next level!"</span><span class="p">)</span>
				<span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">die</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="s">"Try harder and smarter to find the solution!"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
	<span class="n">main</span><span class="p">()</span>
</pre></table></code></div></div><h3 file="Mariana.py" id="solve-2">solve</h3><p>なにも考えずに、条件で$x &lt; p$ が通ることが確認できるので、 $1-p$投げておしまいです。</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Mariana.py"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>


<span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">"65.21.255.31"</span> <span class="p">,</span><span class="mi">32066</span><span class="p">)</span>
<span class="n">io</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"x.   |"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">())</span>

<span class="n">ps</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">gs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">anss</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">cnt</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">while</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
    <span class="c1"># recv
</span>    <span class="n">p</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">(</span><span class="bp">None</span><span class="p">).</span><span class="n">decode</span><span class="p">()[</span><span class="mi">5</span><span class="p">:])</span>
    <span class="n">g</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">(</span><span class="bp">None</span><span class="p">).</span><span class="n">decode</span><span class="p">()[</span><span class="mi">5</span><span class="p">:])</span>
    <span class="n">ps</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">gs</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
    
    <span class="c1"># calc
</span>    <span class="n">ans</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">p</span>
    <span class="n">io</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ans</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>
    <span class="n">result</span> <span class="o">=</span>  <span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"[+] result... "</span><span class="p">,</span><span class="n">result</span><span class="p">)</span>
    <span class="k">if</span> <span class="sa">b</span><span class="s">"ASIS"</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
        <span class="nb">exit</span><span class="p">()</span>

<span class="c1"># ASIS{fiX3d_pOIn7s_f0r_d!5Cret3_l0g4riThmS!}
</span>
</pre></table></code></div></div><h2 file="solve.py" id="crypto-mindseat-33-solve">[crypto] Mindseat [33 solve]</h2><h3 id="chall-3"><span class="mr-2">chall</span><a href="#chall-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="solve.py"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">secret</span> <span class="kn">import</span> <span class="n">params</span><span class="p">,</span> <span class="n">flag</span>

<span class="k">def</span> <span class="nf">keygen</span><span class="p">(</span><span class="n">nbit</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span> <span class="c1"># Pubkey function
</span>	<span class="n">_p</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
		<span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="n">_p</span> <span class="o">+</span> <span class="p">(</span><span class="n">getRandomNBitInteger</span><span class="p">(</span><span class="n">nbit</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="s">'01'</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">isPrime</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isPrime</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
			<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
				<span class="n">s</span> <span class="o">=</span> <span class="n">getRandomRange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span><span class="p">)</span>
				<span class="k">if</span> <span class="nb">pow</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
					<span class="n">pubkey</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span><span class="p">,</span> <span class="n">s</span>
					<span class="k">return</span> <span class="n">pubkey</span>

<span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">pubkey</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
	<span class="n">n</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">pubkey</span>
	<span class="n">r</span> <span class="o">=</span> <span class="n">getRandomRange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
	<span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span>

<span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span><span class="p">.</span><span class="n">lstrip</span><span class="p">(</span><span class="sa">b</span><span class="s">'ASIS{'</span><span class="p">).</span><span class="n">rstrip</span><span class="p">(</span><span class="sa">b</span><span class="s">'}'</span><span class="p">)</span>
<span class="n">nbit</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">params</span>
<span class="n">PUBKEYS</span> <span class="o">=</span> <span class="p">[</span><span class="n">keygen</span><span class="p">(</span><span class="n">nbit</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
<span class="n">flag</span> <span class="o">=</span> <span class="p">[</span><span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">8</span><span class="p">:</span><span class="n">i</span><span class="o">*</span><span class="mi">8</span> <span class="o">+</span> <span class="mi">8</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
<span class="n">ENCS</span> <span class="o">=</span> <span class="p">[</span><span class="n">encrypt</span><span class="p">(</span><span class="n">PUBKEYS</span><span class="p">[</span><span class="n">_</span><span class="p">],</span> <span class="n">flag</span><span class="p">[</span><span class="n">_</span><span class="p">])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'PUBKEYS = </span><span class="si">{</span><span class="n">PUBKEYS</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'ENCS = </span><span class="si">{</span><span class="n">ENCS</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
</pre></table></code></div></div><h3 file="mindseat_updated.py" id="solve-3">solve</h3><p>今回の時間食った元凶君(まじで)</p><p>さておき、この問題は2 パートに分かれます</p><ul><li>$n$から$p,q$の復元<li>$enc = s^m * r^{2 ^ k} \pmod n$ から $m$ の復元</ul><h4 id="part-1"><span class="mr-2">part 1</span><a href="#part-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>手始めにgetRandomNBitIntegerの $k$ の値を知る必要があるが、単純に $p*q = (r_p*2^k+1)*(r_q*2^k+1) $ を考えれば、$ n$ の下位ビットを見て$0$ が続く長さを考えれば $k$ の値を決め打ちできる。今回は $134$ だった。</p><p>それにより $r_p,r_q$ の長さも見えてくる。$n$ が$512$ビットより$p,q$ のそれぞれの乱数部分の長さは $256-k$ ビットとなり。defundパイセンの<a href="https://github.com/defund/coppersmith">coppersmith</a>で復元できる。</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="mindseat_updated.py"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">dec_para</span><span class="p">(</span><span class="n">PUB</span><span class="p">,</span><span class="n">ENC</span><span class="p">):</span>
    <span class="n">N</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="n">PUB</span>
    
    <span class="n">k</span> <span class="o">=</span> <span class="mi">134</span>
    <span class="n">P</span><span class="p">.</span><span class="o">&lt;</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
    <span class="n">_p</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">poly3</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="o">^</span><span class="n">k</span> <span class="o">+</span> <span class="n">_p</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="o">*</span><span class="mi">2</span><span class="o">^</span><span class="n">k</span> <span class="o">+</span> <span class="n">_p</span><span class="p">)</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="p">(</span><span class="mi">256</span><span class="o">-</span><span class="n">k</span><span class="p">),</span> <span class="mi">2</span><span class="o">^</span><span class="p">(</span><span class="mi">256</span><span class="o">-</span><span class="n">k</span><span class="p">))</span>
    <span class="n">roots</span> <span class="o">=</span> <span class="n">small_roots</span><span class="p">(</span><span class="n">poly3</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="n">roots</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">roots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">^</span><span class="n">k</span> <span class="o">+</span> <span class="n">_p</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">roots</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">^</span><span class="n">k</span> <span class="o">+</span> <span class="n">_p</span>
    <span class="k">assert</span> <span class="n">isPrime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">isPrime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span><span class="o">==</span><span class="n">N</span>
</pre></table></code></div></div><h4 file="dec_para.py" id="part-2">part 2</h4><p>$enc = s^m * r^{2 ^ k} \pmod n$ より $r$ が邪魔なので$enc^{\frac{\phi(n)}{2^k}} = s^{\frac{m\phi(n)}{2^k}} * r^{\phi(n)} \pmod n = s^{\frac{m\phi(n)}{2^k}} \pmod n$ になり、dis_cretelogで求めてしまい。今回は、念のため $p,q$分けて行った。</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="dec_para.py"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>
    <span class="n">k</span>  <span class="o">=</span><span class="mi">134</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
    <span class="n">e_</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="nb">int</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">discrete_log</span><span class="p">(</span><span class="n">GF</span><span class="p">(</span><span class="n">p</span><span class="p">)(</span><span class="n">c</span><span class="p">)</span><span class="o">^</span><span class="n">e_</span><span class="p">,</span><span class="n">GF</span><span class="p">(</span><span class="n">p</span><span class="p">)(</span><span class="n">s</span><span class="p">)</span><span class="o">^</span><span class="n">e_</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s">"*"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></table></code></div></div><div file="decrypt.py" class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="decrypt.py"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="n">PUBKEYS</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">10342840547250370454282840290754052390564265157174829726645242904324433774727630591803186632486959590968595230902808369991240437077297674551123187830095873</span><span class="p">,</span> <span class="mi">5179654005441544601140101875149402241567866059199512232495766031194848985776186595289740052214499657697650832860279375151687044465018028876445070588827777</span><span class="p">),</span> <span class="p">(</span><span class="mi">6015512135462554031390611730578383462516861987731833360559070749140159284050335604168414434218196369921956160353365713819898567416920672209509202941444097</span><span class="p">,</span> <span class="mi">2116441415129068001049624780654272734931672052541246678702416144768611225693039503554945326959705314527114860312641379671935648337975482830939466425225421</span><span class="p">),</span> <span class="p">(</span><span class="mi">6396980904648302374999086102690071222661654639262566535518341836426544747072554109709902085144158785649143907600058913175220229111171441332366557866622977</span><span class="p">,</span> <span class="mi">1760317994074087854211747561546045780795134924237097786412713825282874589650448491771874326890983429137451463523250670379970999252639812107914977960011738</span><span class="p">),</span> <span class="p">(</span><span class="mi">9158217300815233129401608406766983222991414185115152402477702381950519098200234724856258589693986849049556254969769863821366592458050807400542885348638721</span><span class="p">,</span> <span class="mi">6564146847894132872802575925374338252984765675686108816080170162797938388434600448954826704720292576935713424103133182090390089661059813982670332877677256</span><span class="p">)]</span>
<span class="n">ENCS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4595268033054096192076432659360373235610019564489694608733743330870893803828258295069937060360520598446948290913045781945314108935153236291467160667601985</span><span class="p">,</span> <span class="mi">3390637292181370684803039833768819598968576813582112632809296088618666221278429695211004046274005776653775480723833818255766663573061866194380012311184611</span><span class="p">,</span> <span class="mi">5197599582013327040903216369733466147938613487439777125659892779696104407398257678982801768761973934713675657188014051286238194316997970299887749668838196</span><span class="p">,</span> <span class="mi">5093835186720390391696398671365109925058893544530286148616117890366909889206952477053316867658405460457795493886317792695055944930027477761411273933822112</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">small_roots</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="p">:</span>
		<span class="n">d</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">degree</span><span class="p">()</span>

	<span class="n">R</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">base_ring</span><span class="p">()</span>
	<span class="n">N</span> <span class="o">=</span> <span class="n">R</span><span class="p">.</span><span class="n">cardinality</span><span class="p">()</span>
	
	<span class="n">f</span> <span class="o">/=</span> <span class="n">f</span><span class="p">.</span><span class="n">coefficients</span><span class="p">().</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">change_ring</span><span class="p">(</span><span class="n">ZZ</span><span class="p">)</span>

	<span class="n">G</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">([],</span> <span class="n">f</span><span class="p">.</span><span class="n">parent</span><span class="p">())</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
		<span class="n">base</span> <span class="o">=</span> <span class="n">N</span><span class="o">^</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">f</span><span class="o">^</span><span class="n">i</span>
		<span class="k">for</span> <span class="n">shifts</span> <span class="ow">in</span> <span class="n">itertools</span><span class="p">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="n">repeat</span><span class="o">=</span><span class="n">f</span><span class="p">.</span><span class="n">nvariables</span><span class="p">()):</span>
			<span class="n">g</span> <span class="o">=</span> <span class="n">base</span> <span class="o">*</span> <span class="n">prod</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">power</span><span class="p">,</span> <span class="n">f</span><span class="p">.</span><span class="n">variables</span><span class="p">(),</span> <span class="n">shifts</span><span class="p">))</span>
			<span class="n">G</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

	<span class="n">B</span><span class="p">,</span> <span class="n">monomials</span> <span class="o">=</span> <span class="n">G</span><span class="p">.</span><span class="n">coefficient_matrix</span><span class="p">()</span>
	<span class="n">monomials</span> <span class="o">=</span> <span class="n">vector</span><span class="p">(</span><span class="n">monomials</span><span class="p">)</span>

	<span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="n">monomial</span><span class="p">(</span><span class="o">*</span><span class="n">bounds</span><span class="p">)</span> <span class="k">for</span> <span class="n">monomial</span> <span class="ow">in</span> <span class="n">monomials</span><span class="p">]</span>
	<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">factor</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">factors</span><span class="p">):</span>
		<span class="n">B</span><span class="p">.</span><span class="n">rescale_col</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span>

	<span class="n">B</span> <span class="o">=</span> <span class="n">B</span><span class="p">.</span><span class="n">dense_matrix</span><span class="p">().</span><span class="n">LLL</span><span class="p">()</span>

	<span class="n">B</span> <span class="o">=</span> <span class="n">B</span><span class="p">.</span><span class="n">change_ring</span><span class="p">(</span><span class="n">QQ</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">factor</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">factors</span><span class="p">):</span>
		<span class="n">B</span><span class="p">.</span><span class="n">rescale_col</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">factor</span><span class="p">)</span>

	<span class="n">H</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">([],</span> <span class="n">f</span><span class="p">.</span><span class="n">parent</span><span class="p">().</span><span class="n">change_ring</span><span class="p">(</span><span class="n">QQ</span><span class="p">))</span>
	<span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">B</span><span class="o">*</span><span class="n">monomials</span><span class="p">):</span>
		<span class="n">H</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
		<span class="n">I</span> <span class="o">=</span> <span class="n">H</span><span class="p">.</span><span class="n">ideal</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">I</span><span class="p">.</span><span class="n">dimension</span><span class="p">()</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
			<span class="n">H</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">I</span><span class="p">.</span><span class="n">dimension</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">roots</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="n">I</span><span class="p">.</span><span class="n">variety</span><span class="p">(</span><span class="n">ring</span><span class="o">=</span><span class="n">ZZ</span><span class="p">):</span>
				<span class="n">root</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">R</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="n">var</span><span class="p">])</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">f</span><span class="p">.</span><span class="n">variables</span><span class="p">())</span>
				<span class="n">roots</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">roots</span>

	<span class="k">return</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>
    <span class="n">k</span>  <span class="o">=</span><span class="mi">134</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
    <span class="n">e_</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="nb">int</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">discrete_log</span><span class="p">(</span><span class="n">GF</span><span class="p">(</span><span class="n">p</span><span class="p">)(</span><span class="n">c</span><span class="p">)</span><span class="o">^</span><span class="n">e_</span><span class="p">,</span><span class="n">GF</span><span class="p">(</span><span class="n">p</span><span class="p">)(</span><span class="n">s</span><span class="p">)</span><span class="o">^</span><span class="n">e_</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s">"*"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">dec_para</span><span class="p">(</span><span class="n">PUB</span><span class="p">,</span><span class="n">ENC</span><span class="p">):</span>
    <span class="n">N</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="n">PUB</span>
    
    <span class="n">k</span> <span class="o">=</span> <span class="mi">134</span>
    <span class="n">P</span><span class="p">.</span><span class="o">&lt;</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
    <span class="n">_p</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">poly3</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="o">^</span><span class="n">k</span> <span class="o">+</span> <span class="n">_p</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="o">*</span><span class="mi">2</span><span class="o">^</span><span class="n">k</span> <span class="o">+</span> <span class="n">_p</span><span class="p">)</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="p">(</span><span class="mi">256</span><span class="o">-</span><span class="n">k</span><span class="p">),</span> <span class="mi">2</span><span class="o">^</span><span class="p">(</span><span class="mi">256</span><span class="o">-</span><span class="n">k</span><span class="p">))</span>
    <span class="n">roots</span> <span class="o">=</span> <span class="n">small_roots</span><span class="p">(</span><span class="n">poly3</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="n">roots</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">roots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">^</span><span class="n">k</span> <span class="o">+</span> <span class="n">_p</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">roots</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">^</span><span class="n">k</span> <span class="o">+</span> <span class="n">_p</span>
    <span class="k">assert</span> <span class="n">isPrime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">isPrime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span><span class="o">==</span><span class="n">N</span>
    <span class="k">return</span> <span class="n">decrypt</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">q</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">ENC</span><span class="p">))</span>
    

<span class="n">flag</span> <span class="o">=</span> <span class="sa">b</span><span class="s">""</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">flag</span> <span class="o">+=</span><span class="n">dec_para</span><span class="p">(</span><span class="n">PUBKEYS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">ENCS</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
<span class="k">print</span><span class="p">(</span><span class="sa">b</span><span class="s">"ASIS{"</span><span class="o">+</span><span class="n">flag</span><span class="o">+</span><span class="sa">b</span><span class="s">"}"</span><span class="p">)</span>
<span class="c1"># ASIS{N3w_CTF_nEW_Joye_Libert_CrYpt0_5}
</span></pre></table></code></div></div><h2 file="solve.py" id="crypto-desired-curve16-solve">[crypto] Desired curve　[16 solve]</h2><h3 id="chall-4"><span class="mr-2">chall</span><a href="#chall-4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="solve.py"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env sage
</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">flag</span> <span class="kn">import</span> <span class="n">flag</span>

<span class="k">def</span> <span class="nf">die</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
	<span class="n">pr</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
	<span class="n">quit</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">pr</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
	<span class="n">s</span> <span class="o">=</span> <span class="s">" "</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">args</span><span class="p">))</span>
	<span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
	<span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">flush</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">sc</span><span class="p">():</span>
	<span class="k">return</span> <span class="n">sys</span><span class="p">.</span><span class="n">stdin</span><span class="p">.</span><span class="nb">buffer</span><span class="p">.</span><span class="n">readline</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
	<span class="n">border</span> <span class="o">=</span> <span class="s">"|"</span>
	<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="o">*</span><span class="mi">72</span><span class="p">)</span>
	<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="s">"Hi all, now it's time to solve a relatively simple challenge about  "</span><span class="p">,</span> <span class="n">border</span><span class="p">)</span>
	<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="s">"relatively elliptic curves! We will generate an elliptic curve with "</span><span class="p">,</span> <span class="n">border</span><span class="p">)</span>
	<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="s">"your desired parameters, are you ready!?                            "</span><span class="p">,</span> <span class="n">border</span><span class="p">)</span>
	<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="o">*</span><span class="mi">72</span><span class="p">)</span>

	<span class="n">nbit</span> <span class="o">=</span> <span class="mi">256</span>
	<span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="n">nbit</span><span class="p">)</span>
	<span class="n">F</span> <span class="o">=</span> <span class="n">GF</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

	<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
		<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="s">"Send the `y' element of two points in your desired elliptic curve:  "</span><span class="p">)</span>
		<span class="n">ans</span> <span class="o">=</span> <span class="n">sc</span><span class="p">()</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">ans</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s">','</span><span class="p">)]</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="n">die</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="s">"Your parameters are not valid! Bye!!"</span><span class="p">)</span>
		<span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">y1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">y2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1337</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">31337</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">inverse</span><span class="p">(</span><span class="o">-</span><span class="mi">30000</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span>
		<span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">y1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1337</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="n">A</span> <span class="o">*</span> <span class="mi">1337</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span>
		<span class="n">E</span> <span class="o">=</span> <span class="n">EllipticCurve</span><span class="p">(</span><span class="n">GF</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="p">[</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">])</span>
		<span class="n">G</span> <span class="o">=</span> <span class="n">E</span><span class="p">.</span><span class="n">random_point</span><span class="p">()</span>

		<span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
		<span class="k">assert</span> <span class="n">m</span> <span class="o">&lt;</span> <span class="n">q</span>
		<span class="n">C</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="n">G</span>
		<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="sa">f</span><span class="s">'The parameters and encrypted flag are:'</span><span class="p">)</span>
		<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="sa">f</span><span class="s">'q = </span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
		<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="sa">f</span><span class="s">'G = (</span><span class="si">{</span><span class="n">G</span><span class="p">.</span><span class="n">xy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">G</span><span class="p">.</span><span class="n">xy</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s">)'</span><span class="p">)</span>
		<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="sa">f</span><span class="s">'m * G = (</span><span class="si">{</span><span class="n">C</span><span class="p">.</span><span class="n">xy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">C</span><span class="p">.</span><span class="n">xy</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s">)'</span><span class="p">)</span>

		<span class="n">pr</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="sa">f</span><span class="s">'Now find the flag :P'</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
	<span class="n">main</span><span class="p">()</span>
</pre></table></code></div></div><h3 file="desiredcurve.py" id="solve-4">solve</h3><p>やることは簡単で、</p><ul><li>invalid curve attack でsubgroupのオーダーが小さいものを見つける。<li>それを、集めてCRTで復元する。</ul><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="desiredcurve.py"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">timeout_decorator</span> <span class="kn">import</span> <span class="n">timeout</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">"65.21.255.31"</span> <span class="p">,</span><span class="mi">10101</span><span class="p">)</span>
<span class="n">io</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"| Se"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">):</span>
    <span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
    <span class="n">io</span><span class="p">.</span><span class="n">sendline</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span><span class="o">+</span><span class="s">","</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">y2</span><span class="p">)).</span><span class="n">encode</span><span class="p">())</span>
    <span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
    <span class="n">q</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">(</span><span class="bp">None</span><span class="p">).</span><span class="n">decode</span><span class="p">()[</span><span class="mi">5</span><span class="p">:])</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">(</span><span class="bp">None</span><span class="p">).</span><span class="n">decode</span><span class="p">()[</span><span class="mi">2</span><span class="o">+</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span><span class="p">:].</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">)</span>
    <span class="n">mG</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">(</span><span class="bp">None</span><span class="p">).</span><span class="n">decode</span><span class="p">()[</span><span class="mi">2</span><span class="o">+</span><span class="mi">8</span><span class="o">+</span><span class="mi">1</span><span class="p">:].</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">)</span>
    <span class="n">Gx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">Gy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">replace</span><span class="p">(</span><span class="s">")"</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>
    <span class="n">mGx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mG</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">mGy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mG</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">replace</span><span class="p">(</span><span class="s">")"</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>    
    <span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">q</span> <span class="p">,</span> <span class="p">(</span><span class="n">Gx</span><span class="p">,</span><span class="n">Gy</span><span class="p">)</span> <span class="p">,(</span><span class="n">mGx</span><span class="p">,</span><span class="n">mGy</span><span class="p">)</span>


<span class="c1"># I adjusted to https://furutsuki.hatenablog.com/entry/2020/05/05/112207
</span><span class="k">def</span> <span class="nf">search_para</span><span class="p">(</span><span class="n">P</span><span class="p">):</span>
    <span class="o">@</span><span class="n">timeout</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">timeout_exception</span><span class="o">=</span><span class="nb">Exception</span><span class="p">,</span> <span class="n">use_signals</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">factorize</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">prime_factors</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="n">F</span> <span class="o">=</span> <span class="n">GF</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    
        <span class="n">y1</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">P</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">P</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">y1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">y2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1337</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">31337</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="mi">30000</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span>
        <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">y1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1337</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="n">A</span> <span class="o">*</span> <span class="mi">1337</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span>
        <span class="n">EC</span> <span class="o">=</span> <span class="n">EllipticCurve</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="p">[</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">])</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">EC</span><span class="p">.</span><span class="n">order</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">factors</span> <span class="o">=</span> <span class="n">factorize</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">suborder</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">factors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">**</span><span class="mi">10</span><span class="p">:</span>
                <span class="n">suborder</span> <span class="o">=</span> <span class="n">f</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">EC</span><span class="p">.</span><span class="n">gen</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">order</span> <span class="o">//</span> <span class="n">suborder</span><span class="p">)</span>
        
        <span class="c1"># print({
</span>        <span class="c1">#     "generator": g.xy(),
</span>        <span class="c1">#     "order": suborder,
</span>        <span class="c1">#     "y1": y1,
</span>        <span class="c1">#     "y2":y2,
</span>        <span class="c1">#     "q": q,
</span>        <span class="c1"># }, ",")
</span>        
        <span class="k">return</span> <span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">suborder</span>

<span class="n">y1</span><span class="p">,</span><span class="n">y2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span>

<span class="n">q</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">mG</span><span class="o">=</span> <span class="n">send</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
<span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">y1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">y2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1337</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">31337</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="mi">30000</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">y1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1337</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="n">A</span> <span class="o">*</span> <span class="mi">1337</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">EllipticCurve</span><span class="p">(</span><span class="n">GF</span><span class="p">(</span><span class="n">q</span><span class="p">),[</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">])</span>

<span class="n">dlog</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">odr</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">phimation</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">suborder</span> <span class="o">=</span> <span class="n">search_para</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">q</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">mG</span><span class="o">=</span> <span class="n">send</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">y1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">y2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1337</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">31337</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="mi">30000</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span>
    <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">y1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1337</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="n">A</span> <span class="o">*</span> <span class="mi">1337</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">EllipticCurve</span><span class="p">(</span><span class="n">GF</span><span class="p">(</span><span class="n">q</span><span class="p">),[</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">])</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
    <span class="n">mG</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">mG</span><span class="p">)</span>
    <span class="n">phimation</span> <span class="o">*=</span> <span class="n">suborder</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"[*] subord ="</span><span class="p">,</span> <span class="n">suborder</span><span class="p">)</span>    
    <span class="k">print</span><span class="p">(</span><span class="s">"[*] persentage ="</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">phimation</span><span class="p">).</span><span class="n">bit_length</span><span class="p">())</span><span class="o">//</span><span class="nb">int</span><span class="p">(</span><span class="n">E</span><span class="p">.</span><span class="n">order</span><span class="p">()).</span><span class="n">bit_length</span><span class="p">(),</span><span class="s">"%"</span><span class="p">)</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s">"[*] start dlog"</span><span class="p">)</span>
    <span class="n">dlog</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">discrete_log</span><span class="p">(</span><span class="n">mG</span><span class="o">*</span><span class="p">(</span><span class="n">E</span><span class="p">.</span><span class="n">order</span><span class="p">()</span><span class="o">//</span><span class="n">suborder</span><span class="p">),</span><span class="n">G</span><span class="o">*</span><span class="p">(</span><span class="n">E</span><span class="p">.</span><span class="n">order</span><span class="p">()</span><span class="o">//</span><span class="n">suborder</span><span class="p">),</span> <span class="n">operation</span><span class="o">=</span><span class="s">"+"</span><span class="p">,</span><span class="nb">ord</span><span class="o">=</span><span class="n">E</span><span class="p">.</span><span class="n">order</span><span class="p">()))</span>
    <span class="n">odr</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">suborder</span><span class="p">)</span>
    
    <span class="n">m</span> <span class="o">=</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">CRT</span><span class="p">(</span><span class="n">dlog</span><span class="p">,</span> <span class="n">odr</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"[+] find dlog ..."</span><span class="p">,</span><span class="n">m</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">)</span>
    <span class="k">if</span> <span class="sa">b</span><span class="s">"ASIS"</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
        <span class="nb">exit</span><span class="p">()</span>
<span class="c1"># ASIS{(e$l6LH_JfsJ:~&lt;}1v&amp;}
</span></pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf/'>ctf</a>, <a href='/categories/writeup/'>writeup</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/cryptography/" class="post-tag no-text-decoration" >cryptography</a> <a href="/tags/writeup/" class="post-tag no-text-decoration" >writeup</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=ASIS+CTF+2022+writeup+-+kanon&url=https%3A%2F%2Fkanzya.github.io%2Fposts%2FASIS-CTF-writeup%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=ASIS+CTF+2022+writeup+-+kanon&u=https%3A%2F%2Fkanzya.github.io%2Fposts%2FASIS-CTF-writeup%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fkanzya.github.io%2Fposts%2FASIS-CTF-writeup%2F&text=ASIS+CTF+2022+writeup+-+kanon" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/CPCTF-writeup/">CPCTF 2023 writeup</a><li><a href="/posts/zer0ptsCTF-writeup/">zer0pts 2023 writeup</a><li><a href="/posts/DEFCON/">DEF CON31参加記</a><li><a href="/posts/(copy)/">十月初週のupsolve</a><li><a href="/posts/">十月初週のupsolve</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/cryptography/">cryptography</a> <a class="post-tag" href="/tags/advent-calendar/">advent_calendar</a> <a class="post-tag" href="/tags/def-con31/">DEF CON31</a> <a class="post-tag" href="/tags/tech/">tech</a> <a class="post-tag" href="/tags/university/">university</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/cyberapocarypse-writeup/"><div class="card-body"> <em class="small" data-ts="1653276780" data-df="ll" > May 23, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>cyberapocarypse 2022 writeup</h3><div class="text-muted small"><p> 去年初めて参加した大会がこの大会で1問しか解けなかった。 でも、今年はcrypto 7/10解けたんで割と満足してます.. [crypto] Android-In-The-Middle [505 solve] chall from Crypto.Cipher import AES from Crypto.Util.number import long_to_bytes import h...</p></div></div></a></div><div class="card"> <a href="/posts/HeroCTF-v4-writeup/"><div class="card-body"> <em class="small" data-ts="1653832800" data-df="ll" > May 29, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hero CTF v4 2022 writeup</h3><div class="text-muted small"><p> 息抜きに ただ、cryptoが少なくて残念… [crypto] Poly321 chall #!/usr/bin/env python3 FLAG = &quot;****************************&quot; enc = [] for c in FLAG: v = ord(c) enc.append( v + pow(v, 2) + pow(...</p></div></div></a></div><div class="card"> <a href="/posts/seccon-beginners-writeup/"><div class="card-body"> <em class="small" data-ts="1654405200" data-df="ll" > Jun 5, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>seccon beginners 2022 writeup</h3><div class="text-muted small"><p> さすがに去年よりは成長したかなぁと思います… [crypto] CoughingFox (404 solve) chall from random import shuffle flag = b&quot;ctf4b{XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX}&quot; cipher = [] for i in range(len(flag)): ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/GDG_Algiers_CTF-writeup/" class="btn btn-outline-primary" prompt="Older"><p>GDG Algiers CTF 2022 writeup</p></a> <a href="/posts/buckeye-CTF-writeup/" class="btn btn-outline-primary" prompt="Newer"><p>buckeye CTF 2022 writeup</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/ringbell_un">kanon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/cryptography/">cryptography</a> <a class="post-tag" href="/tags/advent-calendar/">advent_calendar</a> <a class="post-tag" href="/tags/def-con31/">DEF CON31</a> <a class="post-tag" href="/tags/tech/">tech</a> <a class="post-tag" href="/tags/university/">university</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3"></p><button type="button" class="btn btn-primary" aria-label="Update"> </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-PPZFY5DSE3"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-PPZFY5DSE3'); }); </script>
