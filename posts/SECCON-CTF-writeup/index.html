<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="SECCON CTF 2022 writeup" /><meta name="author" content="kanon" /><meta property="og:locale" content="en" /><meta name="description" content="初めに SECCONでちょっと出来なかったことが多すぎたので分かる範囲で纏めました。" /><meta property="og:description" content="初めに SECCONでちょっと出来なかったことが多すぎたので分かる範囲で纏めました。" /><link rel="canonical" href="https://kanzya.github.io/posts/SECCON-CTF-writeup/" /><meta property="og:url" content="https://kanzya.github.io/posts/SECCON-CTF-writeup/" /><meta property="og:site_name" content="kanon" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-11-14T14:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="SECCON CTF 2022 writeup" /><meta name="twitter:site" content="@_k4non" /><meta name="twitter:creator" content="@kanon" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"kanon"},"dateModified":"2024-03-22T19:18:25+09:00","datePublished":"2022-11-14T14:00:00+09:00","description":"初めに SECCONでちょっと出来なかったことが多すぎたので分かる範囲で纏めました。","headline":"SECCON CTF 2022 writeup","mainEntityOfPage":{"@type":"WebPage","@id":"https://kanzya.github.io/posts/SECCON-CTF-writeup/"},"url":"https://kanzya.github.io/posts/SECCON-CTF-writeup/"}</script><title>SECCON CTF 2022 writeup | kanon</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="kanon"><meta name="application-name" content="kanon"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&family=Noto+Sans+JP:wght@400;600;700;900"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://raw.githubusercontent.com/kanzya/photo/main/image.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">kanon</a></div><div class="site-subtitle font-italic">just a person</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/kanzya" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/_k4non" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['pahc1h8a','s.okayama-u.ac.jp'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>SECCON CTF 2022 writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4 pb-5"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>SECCON CTF 2022 writeup</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1668402000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Nov 14, 2022 </em> </span> <span> Updated <em class="" data-ts="1711102705" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Mar 22, 2024 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3928 words"> <em>21 min</em> read</span></div></div></div><div class="post-content"><h1 id="初めに">初めに</h1><p>SECCONでちょっと出来なかったことが多すぎたので分かる範囲で纏めました。</p><p>jyankenとwitches_symmetric_examはまた次回にでも… それよりも問題なのが<strong>this_is_not_lsb</strong>がほんとにLLLで解けるのかということで、手元で組んだ感じ全部失敗したのでなえてます。はい。。。</p><p>年末までにbit長さでのEHNPとHNPのお気持ちを理解したい所存です。(がんばるます…!!)</p><h2 id="pqpq"><span class="mr-2">pqpq</span><a href="#pqpq" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="chall"><span class="mr-2">chall</span><a href="#chall" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">Crypto.Random</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">flag</span> <span class="kn">import</span> <span class="n">flag</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">r</span>
<span class="n">e</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">65537</span>

<span class="k">assert</span> <span class="n">n</span><span class="p">.</span><span class="n">bit_length</span><span class="p">()</span> <span class="o">//</span> <span class="mi">8</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="n">padding</span> <span class="o">=</span> <span class="n">get_random_bytes</span><span class="p">(</span><span class="n">n</span><span class="p">.</span><span class="n">bit_length</span><span class="p">()</span> <span class="o">//</span> <span class="mi">8</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">flag</span><span class="p">))</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">padding</span> <span class="o">+</span> <span class="n">flag</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">m</span> <span class="o">&lt;</span> <span class="n">n</span>

<span class="n">c1p</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">c1q</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">cm</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">c1</span> <span class="o">=</span> <span class="p">(</span><span class="n">c1p</span> <span class="o">-</span> <span class="n">c1q</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span>
<span class="n">c2</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">q</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"e = </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="c1"># p^e - q^e mod n
</span><span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"c1 = </span><span class="si">{</span><span class="n">c1</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="c1"># (p-q)^e mod n
</span><span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"c2 = </span><span class="si">{</span><span class="n">c2</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="c1"># m^e mod n
</span><span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"cm = </span><span class="si">{</span><span class="n">cm</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</pre></table></code></div></div><h3 id="solve"><span class="mr-2">solve</span><a href="#solve" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="1step--pqrの導出"><span class="mr-2">1STEP : $p,q,r$の導出</span><a href="#1step--pqrの導出" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>$c_1 \equiv p^e - q^e \mod n,c_2 \equiv (p-q)^e \mod n$であることより$c_1-c_2 \equiv (p^e - q^e) - (p^e+q^e + \sum^{e-1}<em>{i=1}\ _eC_ip^i(-q)^{e-i})\equiv q(-2q^ {e-1}+ \sum^{e-1}</em>{i=1}\ _eC_ip^i(-q)^{e-i-1}))$となる。</p><p>よって、$n=pqr$であることより$c_1-c_2$と$n$のGCDを取れば$q$が求まる。</p><p>$c_1 \equiv p^e \mod q$, $e=2*65537$であるので $d \equiv 65537^{-1} \mod q-1$とすれば$p^2 \equiv c_1^d \mod q $となる。</p><p>よって、$p^2$の平方根を求めることで$p$がもとまると同時に$n$より$r$も求まる。</p><h4 id="2step--復号"><span class="mr-2">2STEP : 復号</span><a href="#2step--復号" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>$GCD(e,(p-1)(q-1)(r-1))) \neq1 $より単純な計算では$d$が求まらないので、素数ごとに復元してCRTで求めるようにする。</p><p>よって$GCD(\frac{e}{2},(p-1)(q-1)(r-1))) =1 $より単純な計算で$\frac{e}{2}$の逆元を求めることで以下の式が求まる。</p><p>$ d_p \equiv \frac{e}{2}^{-1} \mod p-1,d_q \equiv \frac{e}{2}^{-1} \mod q-1,d_r \equiv \frac{e}{2}^{-1} \mod r-1$</p><p>よって、$m_p^2 \equiv cm^{d_p} \mod p,m_q^2 \equiv cm^{d_q} \mod q,m_r^2 \equiv cm^{d_r} \mod r$ となりそれぞれの平方根を組み合わせてCRTで復元してflagが求まる。</p><div file="solve.sage" class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="solve.sage"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">Crypto.Random</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
 

<span class="n">e</span> <span class="o">=</span> <span class="mi">131074</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">587926815910957928506680558951380405698765957736660571041732511939308424899531125274073420353104933723578377320050609109973567093301465914201779673281463229043539776071848986139657349676692718889679333084650490543298408820393827884588301690661795023628407437321580294262453190086595632660415087049509707898690300735866307908684649384093580089579066927072306239235691848372795522705863097316041992762430583002647242874432616919707048872023450089003861892443175057</span>
<span class="n">c1</span> <span class="o">=</span> <span class="mi">92883677608593259107779614675340187389627152895287502713709168556367680044547229499881430201334665342299031232736527233576918819872441595012586353493994687554993850861284698771856524058389658082754805340430113793873484033099148690745409478343585721548477862484321261504696340989152768048722100452380071775092776100545951118812510485258151625980480449364841902275382168289834835592610827304151460005023283820809211181376463308232832041617730995269229706500778999</span>
<span class="n">c2</span> <span class="o">=</span> <span class="mi">46236476834113109832988500718245623668321130659753618396968458085371710919173095425312826538494027621684566936459628333712619089451210986870323342712049966508077935506288610960911880157875515961210931283604254773154117519276154872411593688579702575956948337592659599321668773003355325067112181265438366718228446448254354388848428310614023369655106639341893255469632846938342940907002778575355566044700049191772800859575284398246115317686284789740336401764665472</span>
<span class="n">cm</span> <span class="o">=</span> <span class="mi">357982930129036534232652210898740711702843117900101310390536835935714799577440705618646343456679847613022604725158389766496649223820165598357113877892553200702943562674928769780834623569501835458020870291541041964954580145140283927441757571859062193670500697241155641475887438532923910772758985332976303801843564388289302751743334888885607686066607804176327367188812325636165858751339661015759861175537925741744142766298156196248822715533235458083173713289585866</span>

<span class="c1"># 1019 601 739
# 36230691
# e = 131074
# n = 452577641
# c1 = 64229228
# c2 = 200519200
# cm = 18095470
</span><span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="sa">b</span><span class="s">"1234567890"</span><span class="p">)</span>
<span class="c1"># p*q
</span><span class="n">q</span> <span class="o">=</span> <span class="n">GCD</span><span class="p">(</span><span class="n">c1</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">n</span><span class="o">%</span><span class="n">q</span> <span class="o">==</span> <span class="mi">0</span>
<span class="n">pr</span> <span class="o">=</span> <span class="n">n</span><span class="o">//</span> <span class="n">q</span>
<span class="k">assert</span> <span class="n">isPrime</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

<span class="n">p2</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="nb">pow</span><span class="p">(</span><span class="n">e</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">q</span><span class="p">)</span>
<span class="c1"># print(pow(c1,pow(e//2,-1,q-1),q))
# print(pow(823,e,q))
# print(823%q,pow(823,2,q))
# print(p2,q)
</span>
<span class="c1"># print(mod(p2, q).sqrt(all = True))
# p = 7572427786695057270624844967644562609112132599800420296747189080920032359205995588384031542287784540006438555802994008688795974493684400576592403320929717
</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">mod</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">q</span><span class="p">).</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">all</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">+=</span> <span class="n">i</span><span class="o">*</span><span class="n">q</span>
        <span class="c1"># print(p,isPrime(p))
</span>        <span class="k">if</span> <span class="n">n</span><span class="o">%</span><span class="n">p</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="c1"># print(p)
</span>            <span class="k">break</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">7572427786695057270624844967644562609112132599800420296747189080920032359205995588384031542287784540006438555802994008688795974493684400576592403320929717</span>
<span class="k">assert</span> <span class="n">isPrime</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">isPrime</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">n</span><span class="o">%</span><span class="n">p</span><span class="o">==</span><span class="mi">0</span>
<span class="k">assert</span> <span class="n">n</span><span class="o">%</span><span class="n">q</span><span class="o">==</span><span class="mi">0</span> 
<span class="n">r</span> <span class="o">=</span> <span class="n">n</span><span class="o">//</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">q</span><span class="p">)</span>
<span class="c1"># print(r)
</span><span class="k">assert</span> <span class="n">isPrime</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">n</span><span class="o">%</span><span class="n">r</span><span class="o">==</span><span class="mi">0</span>


<span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">pow</span><span class="p">(</span><span class="n">mod</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="nb">pow</span><span class="p">(</span><span class="n">e</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">p</span><span class="p">),</span> <span class="n">p</span><span class="p">).</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">all</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">e</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="o">==</span><span class="n">c</span>
    <span class="k">return</span> <span class="n">mod</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="nb">pow</span><span class="p">(</span><span class="n">e</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">p</span><span class="p">),</span> <span class="n">p</span><span class="p">).</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">all</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>



<span class="k">for</span> <span class="n">cp</span><span class="p">,</span><span class="n">cq</span><span class="p">,</span><span class="n">cr</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="n">search</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="n">search</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="n">search</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span><span class="n">r</span><span class="p">))):</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cp</span><span class="p">))</span>
    <span class="c1"># input()
</span>    <span class="n">tmp</span> <span class="o">=</span> <span class="n">CRT</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">cp</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">cq</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">cr</span><span class="p">)],[</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">])</span>
    <span class="k">if</span> <span class="sa">b</span><span class="s">"SECCON"</span> <span class="ow">in</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="n">tmp</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">tmp</span><span class="p">))</span>
        
<span class="c1"># SECCON{being_able_to_s0lve_this_1s_great!}
</span>
</pre></table></code></div></div><h2 id="bbb"><span class="mr-2">BBB</span><a href="#bbb" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="chall-1"><span class="mr-2">chall</span><a href="#chall-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="n">bytes_to_long</span><span class="p">,</span> <span class="n">getPrime</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">gcd</span>
<span class="kn">from</span> <span class="nn">secret</span> <span class="kn">import</span> <span class="n">FLAG</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">urandom</span>

<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">FLAG</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">100</span>


<span class="k">def</span> <span class="nf">generate_key</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">)):</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">rng</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gcd</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">generate_params</span><span class="p">():</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">p</span><span class="p">,</span><span class="n">a</span> <span class="o">=</span> <span class="n">generate_params</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"[+] The parameters of RNG:"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">a</span><span class="o">=</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">p</span><span class="o">=</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s">"[+] Inject [b]ackdoor!!: "</span><span class="p">))</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">a</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span>

    <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">seeds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">seed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s">"[+] Please input seed: "</span><span class="p">))</span>
        <span class="n">seed</span> <span class="o">%=</span> <span class="n">p</span>
        <span class="k">if</span> <span class="n">seed</span> <span class="ow">in</span> <span class="n">seeds</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[!] Same seeds are not allowed!!"</span><span class="p">)</span>
            <span class="nb">exit</span><span class="p">()</span>
        <span class="n">seeds</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">generate_key</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">e</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[!] `e` is so small!!"</span><span class="p">)</span>
            <span class="nb">exit</span><span class="p">()</span>

        <span class="n">keys</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">e</span><span class="p">))</span>

    <span class="n">flag</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">FLAG</span> <span class="o">+</span> <span class="n">urandom</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[+] Public Key:"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">n</span><span class="o">=</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">e</span><span class="o">=</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[+] Cipher Text:"</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></table></code></div></div><h3 id="upsolve"><span class="mr-2">upsolve</span><a href="#upsolve" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="競技時"><span class="mr-2">競技時</span><a href="#競技時" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>競技時考えていたこととしては、この問題の特徴として</p><ol><li>$n_i$ 同士に対しての共通な素数はない<li>$b$で二次関数を操作できる<ol><li>その二次関数から$e$が生成</ol><li>FLAGに対して128bitのpadding<li>$e$はLCG(2次関数)を適当に繰り返す(10-100回)<li>$e$が11以上</ol><p>が見えたので、1からHastad’s broadcast attack ができるのかなぁと思いつつ、初めに11個のインスタンスからそれぞれ$e=11$と固定したものを取ってきてHastad’s broadcast attack やると当たり前ですが答えは出ません(3. のpaddingによって)。</p><p>なら、$e=12$にして2乗根を2回、3乗根を3回とれば出るかなと思いつつ実行すると、そもそも$GCD(e,phi)\neq 1$となりそもそもできなかった。</p><p>どうしたもんかなと思っていると、2次関数の性質として最大2個の解をもつことがあり、さらに言えば$b$で解を11にしているのでもう1つの解も11となることが言えます。これで2つのseedの値が得ることができたので、残りは以下の式 $\lim_{n \rightarrow\inf} e_{n+1} = e_n^2 + a*e_n +b$ なのでなんかこれ見たことあるなぁと思いまして。。。</p><p><img data-src="https://github.com/kanzya/photo/raw/main/SECCON/BBB.png" alt="BBB" data-proofer-ignore></p><p>少し違いますがイメージとして適当な形で表すとこんな感じ…</p><p>なら、$\lim_{n \rightarrow\inf} e_{n+1} = e_n$であることを追加して考えると$e_n = e_{n-1} \neq e_{n-2},\lim_{n \rightarrow\inf} e_{n} = e_{n-2}$でも問題ないよなと考えたので逆順となる$n \rightarrow n-1\rightarrow n-2$で$e$の値を求めれるじゃん…!!となったので、実装フェーズに移ります。</p><p><strong>ここで問題が発生</strong></p><p>sageって.roots()がありますよね…方程式の根を求めるやつ…あれの存在を完全に忘れていたので2次方程式の解の公式を実装したのですが、これやっちゃいました…</p><p>もうスクリプトはないのであれなんですが実装ミスって終わりました…</p><h4 id="upsolve時"><span class="mr-2">upsolve時</span><a href="#upsolve時" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>てことで、sageの.roots()を使って実装しました…orz</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">gmpy2</span> <span class="kn">import</span> <span class="n">iroot</span>
<span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sage.all</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">const_e</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">%</span><span class="n">p</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">serch_roots</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
        <span class="n">PR</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">GF</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="s">"x"</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">PR</span><span class="p">.</span><span class="n">gen</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span><span class="n">b</span> <span class="o">-</span><span class="n">e</span><span class="p">).</span><span class="n">roots</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">4</span><span class="p">:</span>
                <span class="k">return</span>  <span class="n">ret</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ret</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">ret</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            
            <span class="k">print</span><span class="p">(</span><span class="s">"[+] find "</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
            <span class="n">serch_roots</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">b</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">None</span>

    <span class="n">ns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">es</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">e_</span> <span class="o">=</span> <span class="mi">11</span>

    <span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span> <span class="s">"BBB.seccon.games"</span> <span class="p">,</span><span class="mi">8080</span><span class="p">)</span>
    <span class="c1"># io = process(["python3","chall.py"])
</span>
    <span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>

    <span class="k">exec</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">decode</span><span class="p">())</span>
    <span class="k">exec</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">decode</span><span class="p">())</span>

    <span class="n">io</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"!!: "</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"[+]p"</span><span class="p">,</span><span class="nb">bin</span><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="o">-</span><span class="mi">9</span><span class="p">:])</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">const_e</span><span class="p">(</span><span class="n">e_</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"fin"</span><span class="p">)</span> 
    <span class="n">io</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>


    <span class="n">li</span> <span class="o">=</span> <span class="n">serch_roots</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">e_</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">li</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">io</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">continue</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">li</span><span class="p">):</span>
            
        <span class="n">io</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">" seed: "</span><span class="p">)</span>
        <span class="n">io</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
        <span class="k">exec</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">decode</span><span class="p">())</span>
        <span class="k">exec</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">decode</span><span class="p">())</span>

        <span class="n">ns</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">es</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">cts</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">decode</span><span class="p">().</span><span class="n">replace</span><span class="p">(</span><span class="s">"[+] Cipher Text: "</span><span class="p">,</span><span class="s">""</span><span class="p">)))</span>
    <span class="n">io</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">c</span> <span class="o">=</span> <span class="n">CRT</span><span class="p">(</span><span class="n">cts</span><span class="p">,</span><span class="n">ns</span><span class="p">)</span>

    <span class="n">tmp</span> <span class="o">=</span> <span class="n">iroot</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="n">e_</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span>  <span class="bp">True</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">iroot</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="n">e_</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="nb">exit</span><span class="p">()</span>

</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="o">[</span>+] Opening connection to BBB.seccon.games on port 8080: Done
<span class="o">[</span>+]p 111011001
fin
<span class="o">[</span>+] find  1
<span class="o">[</span>+] find  2
<span class="o">[</span>+] find  3
<span class="o">[</span>+] find  4
<span class="o">[</span>+] find  5
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Closed connection to BBB.seccon.games port 8080
<span class="o">(</span>mpz<span class="o">(</span>2883019091813529219737035153484934929534955887753874746941092955853444099264575760415715710120591467702376578902084283075705374264225673611778863370445183048344031472894050836959651658562832755850169071594495017590365639338557184317630010978441644681967727625313646557515818101<span class="o">)</span>, True<span class="o">)</span>
b<span class="s1">'SECCON{Can_you_find_d_in_bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbdbbbbbbbbbbbbbbbbbbbbbbbbbbbbb?}\xf2\x07\xb3\xce\x19\xb8\x8bNH\xb0\xa6\xac\x10E$u'</span>
</pre></table></code></div></div><h2 id="isufficient"><span class="mr-2">isufficient</span><a href="#isufficient" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="chall-2"><span class="mr-2">chall</span><a href="#chall-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="n">getPrime</span><span class="p">,</span> <span class="n">bytes_to_long</span>
<span class="kn">from</span> <span class="nn">secret</span> <span class="kn">import</span> <span class="n">FLAG</span>

<span class="c1"># f(x,y,z) = a1*x + a2*x^2 + a3*x^3
#          + b1*y + b2*y^2 + b3*y^3
#          + c*z + s mod p
</span><span class="k">def</span> <span class="nf">calc_f</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">coeffs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="nb">pow</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="nb">pow</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">coeffs</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">z</span> <span class="o">*</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">ret</span> <span class="o">%</span> <span class="n">p</span>


<span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>


<span class="c1"># [a1, a2, a3, b1, b2, b3, c, s]
</span><span class="n">coeffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">128</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)]</span>

<span class="n">key</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="n">coeffs</span><span class="p">:</span>
    <span class="n">key</span> <span class="o">&lt;&lt;=</span> <span class="mi">128</span>
    <span class="n">key</span> <span class="o">^=</span> <span class="n">coeff</span>

<span class="n">cipher_text</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">FLAG</span><span class="p">)</span> <span class="o">^</span> <span class="n">key</span>
<span class="k">print</span><span class="p">(</span><span class="n">cipher_text</span><span class="p">)</span>

<span class="n">shares</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">128</span><span class="p">)</span>

    <span class="n">w</span> <span class="o">=</span> <span class="n">calc_f</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">packed_share</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="n">w</span><span class="p">)</span>
    <span class="n">shares</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">packed_share</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">shares</span><span class="p">)</span>	

</pre></table></code></div></div><h3 id="競技時-1"><span class="mr-2">競技時</span><a href="#競技時-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>$ w = a_1*x + a_2*x^2 + a_3*x^3+ b_1*y + b_2*y^2 + b_3*y^3+ c*z + s \mod p $ 、$x,y$は128bit、$p$は512bit、それ以外は128bitで式は4本与えられています。</p><p>既知の値は、それぞれの式の$x,y,w$だけで、目標は係数$a,b,z,c,s$の復元となります。</p><p>はじめに、まぁNHPなのでLLLかなと…思って格子を組みます。具体的に組んだ格子は以下のものです。(くそでかいですが)空白部分は0です</p>\[\begin{bmatrix} p &amp; &amp; &amp; \\ &amp; p &amp;&amp; \\ &amp; &amp; p &amp; \\ &amp; &amp; &amp; p &amp;&amp;&amp;&amp;\\ x_0 &amp; x_1 &amp; x_2 &amp; x_3 &amp; 2^{128}\\ x_0^2 &amp; x_1^2 &amp; x_2^2 &amp; x_3^2 &amp;&amp; 2^{128} \\ x_0^3 &amp; x_1^3 &amp; x_2^3 &amp; x_3^3 &amp;&amp;&amp; 2^{128} \\ y_0 &amp; y_1 &amp; y_2 &amp; y_3 &amp;&amp;&amp;&amp; 2^{128}\\ y_1^2 &amp; y_1^2 &amp; y_2^2 &amp; y_3^2 &amp;&amp;&amp;&amp;&amp; 2^{128} \\ y_1^3 &amp; y_1^3 &amp; y_2^3 &amp; y_3^3 &amp;&amp;&amp;&amp;&amp;&amp; 2^{128}\\ -w_0 &amp; -w_1 &amp; -w_2 &amp; -w_3 &amp;&amp;&amp;&amp;&amp;&amp;&amp; 2^{512} \\ \end{bmatrix}\]<p>ここで $ 0\simeq c*z + s = a_1*x + a_2*x^2 + a_3*x^3+ b_1*y + b_2*y^2 + b_3*y^3 -w +kp$と$a,b$の係数が128bitレベルなので対角成分に$1*2^{128}$を、$w$は一度しか使いたくないので$1*2^{512}$を与えてやってLLLを行う。</p><p>そうするとどこかの行ベクトルに今回用いた$a,b$の値に$2^{128}$されたものと、$2^{512}$が出てくるので探せば今回用いた値を求めることができた。よって今回求まった係数は$a,b,c,s$の内$a,b$となり残りの$c,s$については別途求めなければならない。</p><p>ここから行列の成分から$c*z_i + s$の値は求まるがすべての変数が未知数でどうするのかわからなくて詰んだ…orz</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="n">m</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">m</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">m</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    <span class="n">m</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    
    <span class="n">m</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">m</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    <span class="n">m</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    <span class="n">m</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">^</span><span class="mi">128</span>
    <span class="c1"># m[i,i] = 1
</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
<span class="n">m</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">^</span><span class="mi">512</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">LLL</span><span class="p">()</span>

</pre></table></code></div></div><h4 id="upsolve-1"><span class="mr-2">upsolve</span><a href="#upsolve-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>これを求めるのは意外と単純でGCDでした。(競技中やった記憶あるんだけどなぁ…???)</p><p>$h_i \equiv c*z_i + s \mod p $とすると$c,z_i,s$は128bitで$p$は512bitより実は、$h_i = c*z_i + s$とも表せれることになる。最大公約数を用いて$c = GCD(h_i -h_{i+1},h_{i+1} -h_{i+2})$で求まります。。。</p><p>てことで、$h$の式において$c$の値が出ることがわかった。</p><p>ここで、128bitを128bitで割ると商の大きさはいくつでしょうか…?答えは0 or 1 なので、これを用いると$s$も求まります。$s = h_i\%c + \delta_ic$　ここで、$\delta$は0か1の数です。</p><p>これですべての係数が出そろったのでkeyを復元してflagが求まります。</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>


<span class="n">ct</span> <span class="o">=</span> <span class="mi">115139400156559163067983730101733651044517302092738415230761576068368627143021367186957088381449359016008152481518188727055259259438853550911696408473202582626669824350180493062986420292176306828782792330214492239993109523633165689080824380627230327245751549253757852668981573771168683865251547238022125676591</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">8200291410122039687250292442109878676753589397818032770561720051299309477271228768886216860911120846659270343793701939593802424969673253182414886645533851</span>
<span class="n">xyw</span> <span class="o">=</span> <span class="p">[((</span><span class="mi">6086926015098867242735222866983726204461220951103360009696454681019399690511733951569533187634005519163004817081362909518890288475814570715924211956186561</span><span class="p">,</span> <span class="mi">180544606207615749673679003486920396349643373592065733048594170223181990080540522443341611038923128944258091068067227964575144365802736335177084131200721</span><span class="p">),</span> <span class="mi">358596622670209028757821020375422468786000283337112662091012759053764980353656144756495576189654506534688021724133853284750462313294554223173599545023200</span><span class="p">),</span> <span class="p">((</span><span class="mi">1386358358863317578119640490115732907593775890728347365516358215967843845703994105707232051642221482563536659365469364255206757315665759154598917141827974</span><span class="p">,</span> <span class="mi">4056544903690651970564657683645824587566358589111269611317182863269566520886711060942678307985575546879523617067909465838713131842847785502375410189119098</span><span class="p">),</span> <span class="mi">7987498083862441578197078091675653094495875014017487290616050579537158854070043336559221536943501617079375762641137734054184462590583526782938983347248670</span><span class="p">),</span> <span class="p">((</span><span class="mi">656537687734778409273502324331707970697362050871244803755641285452940994603617400730910858122669191686993796208644537023001462145198921682454359699163851</span><span class="p">,</span> <span class="mi">7168506530157948082373212337047037955782714850395068869680326068416218527056283262697351993204957096383236610668826321537260018440150283660410281255549702</span><span class="p">),</span> <span class="mi">1047085825033120721880384312942308021912742666478829834943737959325181775143075576517355925753610902886229818331095595005460339857743811544053574078662507</span><span class="p">),</span> <span class="p">((</span><span class="mi">5258797924027715460925283932681628978641108698338452367217155856384763787158334845391544834908979711067046042420593321638221507208614929195171831766268954</span><span class="p">,</span> <span class="mi">4425317882205634741873988391516678208287005927456949928854593454650522868601946818897817646576217811686765487183061848994765729348913592238613989095356071</span><span class="p">),</span> <span class="mi">866086803634294445156445022661535120113351818468169243952864826652249446764789342099913962106165135623940932785868082548653702309009757035399759882130676</span><span class="p">)]</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">w</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">x</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">xyw</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">xyw</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">w</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">xyw</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">m</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">m</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    <span class="n">m</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    
    <span class="n">m</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">m</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    <span class="n">m</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    <span class="n">m</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">^</span><span class="mi">128</span>
    <span class="c1"># m[i,i] = 1
</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
<span class="n">m</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">^</span><span class="mi">512</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">LLL</span><span class="p">()</span>
<span class="c1">#cz+ s
</span><span class="n">cz_s</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">coffs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
	<span class="n">cz_s</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">]))</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
	<span class="n">coffs</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="o">^</span><span class="mi">128</span><span class="p">)</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">GCD</span><span class="p">(</span><span class="n">cz_s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">cz_s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">cz_s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">cz_s</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">coffs</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">cz_s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">%</span><span class="n">c</span>
<span class="n">coffs</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">cz_s</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">coffs</span><span class="p">)</span>
<span class="n">key</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">coff</span> <span class="ow">in</span> <span class="n">coffs</span><span class="p">:</span>
    <span class="n">key</span> <span class="o">&lt;&lt;=</span> <span class="mi">128</span>
    <span class="n">key</span> <span class="o">^^=</span> <span class="n">coff</span>
    


<span class="n">cipher_text</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span> <span class="o">^^</span> <span class="n">key</span>
<span class="k">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">cipher_text</span><span class="p">))</span>

<span class="sa">b</span><span class="s">'SECCON{Unfortunately_I_could_not_come_up_with_a_more_difficult_problem_than_last_year_sorry...-6fc18307d3ed2e7673a249abc2e0e22c}'</span>
</pre></table></code></div></div><h2 id="this_is_not_lsb"><span class="mr-2">this_is_not_lsb</span><a href="#this_is_not_lsb" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="chall-3"><span class="mr-2">chall</span><a href="#chall-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">flag</span> <span class="kn">import</span> <span class="n">flag</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">getStrongPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">getStrongPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">d</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"e = </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"flag_length = </span><span class="si">{</span><span class="n">flag</span><span class="p">.</span><span class="n">bit_length</span><span class="p">()</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="c1"># Oops! encrypt without padding!
</span><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"c = </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="c1"># padding format: 0b0011111111........
</span><span class="k">def</span> <span class="nf">check_padding</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="n">padding_pos</span> <span class="o">=</span> <span class="n">n</span><span class="p">.</span><span class="n">bit_length</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">c</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">m</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">padding_pos</span> <span class="o">-</span> <span class="mi">8</span><span class="p">))</span> <span class="o">==</span> <span class="mh">0xFF</span>


<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s">"c = "</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="n">check_padding</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

</pre></table></code></div></div><h3 id="競技中"><span class="mr-2">競技中</span><a href="#競技中" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>なんかDownunderctfのRSA oracle iv とか sekaictfのEZmazeとかで見たことあるなぁと思いつつ</p><p>isufficientと同じ感じで格子組んでました…</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">sage.modules.free_module_integer</span> <span class="kn">import</span> <span class="n">IntegerLattice</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1"># Directly taken from rbtree's LLL repository
# From https://oddcoder.com/LOL-34c3/, https://hackmd.io/@hakatashi/B1OM7HFVI
</span><span class="k">def</span> <span class="nf">Babai_CVP</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
	<span class="n">M</span> <span class="o">=</span> <span class="n">IntegerLattice</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">lll_reduce</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">reduced_basis</span>
	<span class="n">G</span> <span class="o">=</span> <span class="n">M</span><span class="p">.</span><span class="n">gram_schmidt</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
	<span class="n">diff</span> <span class="o">=</span> <span class="n">target</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">nrows</span><span class="p">())):</span>
		<span class="n">diff</span> <span class="o">-=</span>  <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="n">diff</span> <span class="o">*</span> <span class="n">G</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">G</span><span class="p">[</span><span class="n">i</span><span class="p">])).</span><span class="nb">round</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">target</span> <span class="o">-</span> <span class="n">diff</span>


<span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
	<span class="n">num_var</span>  <span class="o">=</span> <span class="n">mat</span><span class="p">.</span><span class="n">nrows</span><span class="p">()</span>
	<span class="n">num_ineq</span> <span class="o">=</span> <span class="n">mat</span><span class="p">.</span><span class="n">ncols</span><span class="p">()</span>

	<span class="n">max_element</span> <span class="o">=</span> <span class="mi">0</span> 
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_var</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_ineq</span><span class="p">):</span>
			<span class="n">max_element</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_element</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]))</span>

	<span class="k">if</span> <span class="n">weight</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
		<span class="n">weight</span> <span class="o">=</span> <span class="n">num_ineq</span> <span class="o">*</span> <span class="n">max_element</span>

    <span class="c1"># sanity checker
</span>	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lb</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_ineq</span><span class="p">:</span>
		<span class="k">print</span><span class="p">(</span><span class="s">"Fail: len(lb) != num_ineq"</span><span class="p">)</span>
		<span class="k">return</span>

	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ub</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_ineq</span><span class="p">:</span>
		<span class="k">print</span><span class="p">(</span><span class="s">"Fail: len(ub) != num_ineq"</span><span class="p">)</span>
		<span class="k">return</span>

	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_ineq</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">lb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">ub</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
			<span class="k">print</span><span class="p">(</span><span class="s">"Fail: lb[i] &gt; ub[i] at index"</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
			<span class="k">return</span>

    	<span class="c1"># heuristic for number of solutions
</span>	<span class="n">DET</span> <span class="o">=</span> <span class="mi">0</span>

	<span class="k">if</span> <span class="n">num_var</span> <span class="o">==</span> <span class="n">num_ineq</span><span class="p">:</span>
		<span class="n">DET</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mat</span><span class="p">.</span><span class="n">det</span><span class="p">())</span>
		<span class="n">num_sol</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_ineq</span><span class="p">):</span>
			<span class="n">num_sol</span> <span class="o">*=</span> <span class="p">(</span><span class="n">ub</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">lb</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">DET</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">print</span><span class="p">(</span><span class="s">"Zero Determinant"</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">num_sol</span> <span class="o">//=</span> <span class="n">DET</span>
			<span class="c1"># + 1 added in for the sake of not making it zero...
</span>			<span class="k">print</span><span class="p">(</span><span class="s">"Expected Number of Solutions : "</span><span class="p">,</span> <span class="n">num_sol</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

	<span class="c1"># scaling process begins
</span>	<span class="n">max_diff</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">ub</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">lb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_ineq</span><span class="p">)])</span>
	<span class="n">applied_weights</span> <span class="o">=</span> <span class="p">[]</span>

	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_ineq</span><span class="p">):</span>
		<span class="n">ineq_weight</span> <span class="o">=</span> <span class="n">weight</span> <span class="k">if</span> <span class="n">lb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">ub</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">else</span> <span class="n">max_diff</span> <span class="o">//</span> <span class="p">(</span><span class="n">ub</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">lb</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
		<span class="n">applied_weights</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">ineq_weight</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_var</span><span class="p">):</span>
			<span class="n">mat</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="n">ineq_weight</span>
		<span class="n">lb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="n">ineq_weight</span>
		<span class="n">ub</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="n">ineq_weight</span>

	<span class="c1"># Solve CVP
</span>	<span class="n">target</span> <span class="o">=</span> <span class="n">vector</span><span class="p">([(</span><span class="n">lb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">ub</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_ineq</span><span class="p">)])</span>
	<span class="n">result</span> <span class="o">=</span> <span class="n">Babai_CVP</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_ineq</span><span class="p">):</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">lb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">ub</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
			<span class="k">print</span><span class="p">(</span><span class="s">"Fail : inequality does not hold after solving"</span><span class="p">)</span>
			<span class="k">break</span>
    
    	<span class="c1"># recover x
</span>	<span class="n">fin</span> <span class="o">=</span> <span class="bp">None</span>

	<span class="k">if</span> <span class="n">DET</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span>
		<span class="n">fin</span> <span class="o">=</span> <span class="n">mat</span><span class="p">.</span><span class="n">solve_right</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
	
	<span class="c1">## recover your result
</span>	<span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">applied_weights</span><span class="p">,</span> <span class="n">fin</span>


<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'this-is-not-lsb.seccon.games'</span><span class="p">,</span> <span class="mi">8080</span><span class="p">)</span>
    <span class="c1"># conn = process(["python3","problem.py"])
</span>    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">conn</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">decode</span><span class="p">().</span><span class="n">strip</span><span class="p">().</span><span class="n">split</span><span class="p">(</span><span class="s">'n = '</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">e</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">conn</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">decode</span><span class="p">().</span><span class="n">strip</span><span class="p">().</span><span class="n">split</span><span class="p">(</span><span class="s">'e = '</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">flag_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">conn</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">decode</span><span class="p">().</span><span class="n">strip</span><span class="p">().</span><span class="n">split</span><span class="p">(</span><span class="s">'flag_length ='</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">c</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">conn</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">decode</span><span class="p">().</span><span class="n">strip</span><span class="p">().</span><span class="n">split</span><span class="p">(</span><span class="s">'c = '</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">print</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">flag_length</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
        <span class="n">conn</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">"c = "</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span> <span class="n">conn</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">decode</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">blinded_query</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">query</span><span class="p">((</span><span class="nb">pow</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">)</span>



    <span class="n">rs_and_Us</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">rs_and_Us</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">r_</span> <span class="o">=</span> <span class="n">r</span>
        <span class="k">if</span> <span class="n">blinded_query</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="n">rs_and_Us</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">).</span><span class="n">bit_length</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'got!'</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rs_and_Us</span><span class="p">))</span>

    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rs_and_Us</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">rs_and_Us</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span>  <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
    <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="n">ub</span> <span class="o">=</span> <span class="p">[</span><span class="n">u</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">u</span> <span class="ow">in</span> <span class="n">rs_and_Us</span><span class="p">]</span>
    <span class="n">sol</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">,[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">N</span><span class="p">,</span> <span class="p">[</span><span class="n">flag_length</span><span class="p">]</span><span class="o">+</span><span class="n">ub</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>
    <span class="n">sol</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">print</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sol</span><span class="p">)))</span>
    <span class="n">conn</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">"SECCON"</span> <span class="ow">in</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sol</span><span class="p">)):</span>
            <span class="nb">exit</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">sol</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="o">^</span><span class="n">flag_length</span><span class="p">:</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="o">-</span><span class="n">sol</span> <span class="o">%</span> <span class="n">n</span>
            <span class="k">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sol</span><span class="p">)))</span>
        <span class="k">if</span> <span class="s">"SECCON"</span> <span class="ow">in</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sol</span><span class="p">)):</span>
                <span class="nb">exit</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">continue</span>
</pre></table></code></div></div><h3 id="upsolve-2"><span class="mr-2">upsolve</span><a href="#upsolve-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>ただ、これだと求まらなかったので色々なupsolve拝見させてもらって得たアイディアを用いて組んで見ましたがどれもダメでした。。。(泣) やっぱりLLLのお気持ちは難しいですねぇ…</p><p>これなら動きましたよ的なアドバイスあればお待ちしてます。。m(_ _)m</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf/'>ctf</a>, <a href='/categories/writeup/'>writeup</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/cryptography/" class="post-tag no-text-decoration" >cryptography</a> <a href="/tags/writeup/" class="post-tag no-text-decoration" >writeup</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=SECCON+CTF+2022+writeup+-+kanon&url=https%3A%2F%2Fkanzya.github.io%2Fposts%2FSECCON-CTF-writeup%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=SECCON+CTF+2022+writeup+-+kanon&u=https%3A%2F%2Fkanzya.github.io%2Fposts%2FSECCON-CTF-writeup%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fkanzya.github.io%2Fposts%2FSECCON-CTF-writeup%2F&text=SECCON+CTF+2022+writeup+-+kanon" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/CPCTF-writeup/">CPCTF 2023 writeup</a><li><a href="/posts/zer0ptsCTF-writeup/">zer0pts 2023 writeup</a><li><a href="/posts/DEFCON/">DEF CON31参加記</a><li><a href="/posts/(copy)/">十月初週のupsolve</a><li><a href="/posts/">十月初週のupsolve</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/cryptography/">cryptography</a> <a class="post-tag" href="/tags/advent-calendar/">advent_calendar</a> <a class="post-tag" href="/tags/def-con31/">DEF CON31</a> <a class="post-tag" href="/tags/tech/">tech</a> <a class="post-tag" href="/tags/university/">university</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/cyberapocarypse-writeup/"><div class="card-body"> <em class="small" data-ts="1653276780" data-df="ll" > May 23, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>cyberapocarypse 2022 writeup</h3><div class="text-muted small"><p> 去年初めて参加した大会がこの大会で1問しか解けなかった。 でも、今年はcrypto 7/10解けたんで割と満足してます.. [crypto] Android-In-The-Middle [505 solve] chall from Crypto.Cipher import AES from Crypto.Util.number import long_to_bytes import h...</p></div></div></a></div><div class="card"> <a href="/posts/HeroCTF-v4-writeup/"><div class="card-body"> <em class="small" data-ts="1653832800" data-df="ll" > May 29, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hero CTF v4 2022 writeup</h3><div class="text-muted small"><p> 息抜きに ただ、cryptoが少なくて残念… [crypto] Poly321 chall #!/usr/bin/env python3 FLAG = &quot;****************************&quot; enc = [] for c in FLAG: v = ord(c) enc.append( v + pow(v, 2) + pow(...</p></div></div></a></div><div class="card"> <a href="/posts/seccon-beginners-writeup/"><div class="card-body"> <em class="small" data-ts="1654405200" data-df="ll" > Jun 5, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>seccon beginners 2022 writeup</h3><div class="text-muted small"><p> さすがに去年よりは成長したかなぁと思います… [crypto] CoughingFox (404 solve) chall from random import shuffle flag = b&quot;ctf4b{XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX}&quot; cipher = [] for i in range(len(flag)): ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/buckeye-CTF-writeup/" class="btn btn-outline-primary" prompt="Older"><p>buckeye CTF 2022 writeup</p></a> <a href="/posts/HITCON-CTF-writeup/" class="btn btn-outline-primary" prompt="Newer"><p>HITCON CTF 2022 writeup</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/ringbell_un">kanon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/cryptography/">cryptography</a> <a class="post-tag" href="/tags/advent-calendar/">advent_calendar</a> <a class="post-tag" href="/tags/def-con31/">DEF CON31</a> <a class="post-tag" href="/tags/tech/">tech</a> <a class="post-tag" href="/tags/university/">university</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3"></p><button type="button" class="btn btn-primary" aria-label="Update"> </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-PPZFY5DSE3"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-PPZFY5DSE3'); }); </script>
